<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ì–´ë©”ì´ì§•ì‚¬ì—…ë¶€ ë¸”ë¡œê·¸ ìë™í™”</title>
  <style>
    :root{ --bg1:#f8fbff; --bg2:#fff7fd; --ink:#111827; --ring:#9b87f5; --accent:#7c3aed; --accent2:#9b87f5; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--ink);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(900px 600px at 12% -8%, var(--bg2), transparent 60%),
        radial-gradient(900px 600px at 108% 8%, #eaf2ff, transparent 55%),
        linear-gradient(180deg, var(--bg1), #fff);
      display:grid;place-items:center;padding:28px;
    }
    .wrap{width:100%;max-width:760px}
    .hero{ text-align:center; margin-bottom:14px; }
    .sticker{
      width:74px;height:74px;margin:0 auto 10px; border-radius:18px;display:grid;place-items:center;overflow:hidden;
      background:linear-gradient(135deg,#fef3c7,#fde68a);border:1px solid #fcd34d;
      box-shadow:inset 0 0 0 3px #ffffffb8,0 10px 26px #f59e0b33;
    }
    .title{
      font-size:28px; font-weight:900; margin:0;
      background:linear-gradient(90deg,#7c3aed,#22d3ee,#7c3aed);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      background-size:200% 100%; animation:shine 4s linear infinite;
      letter-spacing:-0.3px;
    }
    @keyframes shine{0%{background-position:0% 50%}100%{background-position:200% 50%}}
    .card{
      background:#ffffffcc;border:1px solid #eef2ff;border-radius:22px;backdrop-filter:blur(8px);
      box-shadow:0 12px 34px #00000012;padding:20px 18px 16px;
    }
    .ask{
      display:flex;align-items:center;gap:8px;background:#fff;border:1.5px solid #e5e7eb;
      border-radius:999px;padding:10px 10px 10px 14px; box-shadow:0 2px 8px #00000008;
      transition:box-shadow .2s,border .2s;
    }
    .ask input{
      flex:1;border:0;outline:none;font-size:15px;background:transparent;
      padding:6px 2px; min-height:22px;
    }
    .send{
      border:0;cursor:pointer; padding:10px 14px;border-radius:999px;color:#fff;
      background:linear-gradient(135deg,var(--accent2),var(--accent));
      box-shadow:0 8px 18px #7c3aed33, inset 0 -6px 12px #00000014;
      display:inline-flex;align-items:center;gap:8px;font-weight:700;
      transition:transform .06s, filter .15s;
    }
    .send:hover{filter:brightness(1.04)}
    .send:active{transform:translateY(1px)}
    .send[disabled]{opacity:.65;cursor:not-allowed}
    .spin{width:16px;height:16px;border-radius:50%;border:2px solid #ffffff80;border-top-color:#fff;display:inline-block;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .helpers{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;justify-content:center}
    .helper{ font-size:12px;border:1px dashed #e5e7eb;background:#fff;border-radius:999px;padding:6px 10px;cursor:pointer; }
    .res{
      margin-top:14px;background:#fff;border:1px solid #eef2ff;border-radius:16px;padding:14px;min-height:130px;
      white-space:pre-wrap;line-height:1.6
    }
    .placeholder{color:#9ca3af;font-size:14px}
    .status{
      display:flex;align-items:center;gap:10px;font-weight:800;
      background:linear-gradient(90deg,#7c3aed,#22d3ee,#7c3aed);
      -webkit-background-clip:text;background-clip:text;color:transparent;
      background-size:200% 100%;animation:shine 3s linear infinite;
    }
    .test-indicator{position:fixed;top:10px;right:10px;background:#ff6b35;color:#fff;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:bold;z-index:1000;}
    /* edit mode marker */
    .res.editing{ outline:2px dashed #9b87f5; box-shadow: inset 0 0 0 3px #f3f0ff; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="sticker" aria-hidden="true">
        <svg viewBox="0 0 80 80" width="58" height="58">
          <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#fef3c7"/><stop offset="1" stop-color="#fde68a"/></linearGradient></defs>
        <circle cx="40" cy="40" r="28" fill="url(#g)" stroke="#fbbf24" stroke-width="2"/>
        <circle cx="32" cy="35" r="4" fill="#1f2937"/><circle cx="48" cy="35" r="4" fill="#1f2937"/>
        <path d="M28 49 Q40 58 52 49" stroke="#1f2937" stroke-width="3" fill="none" stroke-linecap="round"/>
        <path d="M18 26 26 18 M54 18 62 26" stroke="#f59e0b" stroke-width="3" stroke-linecap="round"/>
        </svg>
      </div>
      <h1 class="title">ì–´ë©”ì´ì§•ì‚¬ì—…ë¶€ ë¸”ë¡œê·¸ ìë™í™”</h1>
    </div>

    <!-- ì¹´ì¹´ì˜¤ ì±„ë„ ë§í¬ ìƒì„±ê¸° -->
    <div class="card" id="chat-link-maker">
      <label style="display:block;font-size:14px;font-weight:800;margin-bottom:10px">
        ì¹´ì¹´ì˜¤í†¡ ë¸”ë¡œê·¸ ì±„ë„ë§í¬ ğŸ”—
      </label>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="k-key" type="text" placeholder=""
               style="flex:1;padding:12px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;outline:none"/>
        <button id="k-make" class="send" type="button">ìƒì„± âœ¨</button>
      </div>

      <div style="display:flex;align-items:center;gap:8px;margin-top:10px">
        <div id="k-result" class="placeholder" style="flex:1;word-break:break-all">
          ê²°ê³¼ ë§í¬ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
        </div>
        <button id="k-copy" class="send" type="button" style="white-space:nowrap">ë³µì‚¬ ğŸ“‹</button>
      </div>
    </div>

    <div class="card">
      <div class="ask">
        <input id="q" autocomplete="off" placeholder="ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
        <button id="send" class="send" type="button"><span id="sendLabel">Send</span> ğŸš€</button>
      </div>

      <!-- helpers: JSê°€ 3ê°œì”© ëœë”ë§í•¨ -->
      <div class="helpers" id="helpers">
        <!-- JS will inject three buttons here -->
      </div>

      <!-- ê²°ê³¼ ì˜ì—­ ì»¨íŠ¸ë¡¤ -->
      <div class="helpers" id="exporters">
        <button class="helper" id="toggleEdit">ìˆ˜ì • ëª¨ë“œ</button>
        <button class="helper" id="downloadHtml" disabled>HTML ì €ì¥</button>
        <button class="helper" id="downloadPdf" disabled>PDF ì €ì¥</button>
      </div>

      <div id="res" class="res"><div class="placeholder">ê²°ê³¼ëŠ” ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div></div>
    </div>
  </div>

  <!-- ê²€ìƒ‰ ì˜ë„í˜• ì£¼ì œ ë¦¬ìŠ¤íŠ¸(JSON, JS ì•„ë‹˜) -->
  <script type="application/json" id="topic-data">[
    "ì‹¤ì†ë³´í—˜ ì²­êµ¬ì„œë¥˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ 2025",
    "ì‹¤ì†ë³´í—˜ ì²­êµ¬ ë°©ë²• ë³‘ì›ì„œë¥˜ë¶€í„° ì•±ì²­êµ¬ê¹Œì§€",
    "ì‹¤ì†ë³´í—˜ í†µì›ë¹„ ì˜ìˆ˜ì¦ ëˆ„ë½ ëŒ€ì²˜ë²•",
    "ì•”ë³´í—˜ ì§„ë‹¨ë¹„ ì§€ê¸‰ì¡°ê±´ í•µì‹¬ì •ë¦¬",
    "ìœ ì‚¬ì•” ë³´ì¥ ë²”ìœ„ ê¸°Â·ê°‘Â·ê²½Â·ì œ ì°¨ì´",
    "ì—¬ì„±ì•” ë³´í—˜ ìœ ë°©ì•”Â·ìê¶ì•” ë¹„êµ 2025",
    "ì§ˆë³‘ìˆ˜ìˆ ë¹„ ë³´ì¥ í•­ëª©ê³¼ ë©´ì±…ê¸°ê°„ ì´í•´",
    "ê³¨ì ˆë³´í—˜ ê¹ìŠ¤Â·í†µì› ë³´ì¥ ì‹¤ì œ ì‚¬ë¡€",
    "ìš´ì „ìë³´í—˜ íŠ¹ì•½ ìµœì†Œ êµ¬ì„± ê°€ì´ë“œ",
    "ìš´ì „ìë³´í—˜ ë©´ì±…Â·ì˜ˆì™¸ ì¡°í•­ ê¼­ ì•Œì•„ë‘ê¸°",
    "ë‡Œí˜ˆê´€ì§ˆí™˜Â·í—ˆí˜ˆì„±ì‹¬ì¥ì§ˆí™˜ ì§„ë‹¨ë¹„ ì°¨ì´",
    "ë‡Œ MRIÂ·MRA ì´¬ì˜ ë³´í—˜ ì²­êµ¬ ê°€ëŠ¥ë²”ìœ„",
    "ì¥ê¸°ìš”ì–‘ë³´í—˜ ë“±ê¸‰ íŒì • ê¸°ì¤€ê³¼ ì¤€ë¹„ì„œë¥˜",
    "ê°„ë³‘ì¸ ë¹„ìš© ë³´ì¥ ì‹¤ì† vs ì •ì•¡ ë¹„êµ",
    "ì¹˜ë§¤ë³´í—˜ ê²½ë„Â·ì¤‘ë“±ë„Â·ì¤‘ì¦ ì§€ê¸‰ê¸°ì¤€",
    "ëŒ€ì²´ì˜ë£Œ ì¤‘ì…ìÂ·ì–‘ì„±ì ì¹˜ë£Œ ë³´ì¥ ë¹„êµ",
    "ì•” ì‚°ì •íŠ¹ë¡€ ì‹ ì²­ ë°©ë²•ê³¼ ì ˆì°¨",
    "í‘œì í•­ì•”Â·ë©´ì—­í•­ì•” ì¹˜ë£Œë¹„ ë³´ì¥ êµ¬ì¡°",
    "ê°±ì‹ í˜• vs ë¹„ê°±ì‹ í˜• ë³´í—˜ ì¥ë‹¨ì  ë¹„êµ",
    "ë¬´í•´ì§€í˜• ë³´í—˜ í™˜ê¸‰ êµ¬ì¡° ì´í•´í•˜ê¸°",
    "ìœ ë³‘ì ë³´í—˜ 3Â·2Â·5 ì¡°ê±´ê³¼ ì¸ìˆ˜ í¬ì¸íŠ¸",
    "ê±´ê°•ê²€ì§„ ì „ ë³´í—˜ ê°€ì… ì‹œ ìœ ì˜ì‚¬í•­",
    "ìš´ì „ìë³´í—˜ ìµœì € êµ¬ì„±ê³¼ ë²Œì Â·ë©´í—ˆì •ì§€ íŠ¹ì•½",
    "ì–´ë¦°ì´ë³´í—˜ íƒœì•„Â·ì¶œìƒ ì§í›„ ë³´ì¥ ì²´í¬",
    "ì‚°ì—…ì¬í•´ë³´í—˜ ì‚°ì¬ ìŠ¹ì¸ ì ˆì°¨ 7ë‹¨ê³„",
    "í•´ì™¸ì—¬í–‰ìë³´í—˜ ì˜ë£ŒÂ·í•­ê³µì§€ì—° ë³´ì¥ ë²”ìœ„",
    "ê³¨ì ˆÂ·í™”ìƒ ìˆ˜ìˆ ë¹„ ì¤‘ë³µ ë³´ì¥ ê°€ëŠ¥í• ê¹Œ",
    "ê¸°íƒ€í”¼ë¶€ì•” ì½”ë“œ ê¸°ì¤€ê³¼ ì²­êµ¬ í¬ì¸íŠ¸",
    "ê°‘ìƒì„ ì•” ì†Œì•¡ì•” ê¸°ì¤€ê³¼ ì˜ˆì™¸ ì‚¬ë¡€",
    "ë³´í—˜ê¸ˆ ë¶€ì§€ê¸‰ ë¹ˆë²ˆí•œ ì‚¬ìœ  TOP7"
  ]</script>

<script>
  // test mode
  function isTestMode() {
    return window.location.search.includes('test=true') || window.location.search.includes('debug=true');
  }
  const HOOKS_BASE = 'https://hooks.xn--h32b21du9cf7grcy2k20f.com';
  const WF_PATH = 'ask';
  const WEBHOOK_URL = isTestMode()
    ? `${HOOKS_BASE}/webhook-test/${WF_PATH}`
    : `${HOOKS_BASE}/webhook/${WF_PATH}`;

  if (isTestMode()) {
    const indicator = document.createElement('div');
    indicator.className = 'test-indicator';
    indicator.textContent = 'TEST MODE';
    document.body.appendChild(indicator);
    console.log('Test mode: Editor live capture enabled');
    console.log('Webhook URL:', WEBHOOK_URL);
  }

  const $ = (s)=>document.querySelector(s);
  const q = $('#q'), btn = $('#send'), res = $('#res'), sendLabel = $('#sendLabel');

  function loading(on){
    if(on){
      btn.disabled = true;
      sendLabel.innerHTML = '<span class="spin"></span>';
      res.innerHTML = '<div class="status"><span class="spin"></span>AI is workingâ€¦</div>';
    } else {
      btn.disabled = false;
      sendLabel.textContent = 'Send';
    }
  }

  async function postJson(url, body){
    const r = await fetch(url,{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body) });
    const text = await r.text();
    let data; try{ data = JSON.parse(text); } catch { data = { raw:text }; }
    return { ok:r.ok, status:r.status, data };
  }

  function looksLikeHtml(s){
    return /^\s*<(?:!DOCTYPE|html|body|main|div|section|article|h1|h2|p|iframe)\b/i.test(s || "");
  }
  function decodeHtmlEntities(str) {
    if (typeof str !== 'string') return str;
    const el = document.createElement("textarea");
    el.innerHTML = str;
    return el.value;
  }
  function extractEmbeddable(htmlString){
    try {
      const s = String(htmlString || "");
      const m = s.match(/^\s*<iframe\b[^>]*\bsrcdoc=(["'])([\s\S]*?)\1[^>]*>\s*<\/iframe>\s*$/i);
      if (m) {
        const ta = document.createElement("textarea");
        ta.innerHTML = m[2];
        return ta.value;
      }
      if (/^\s*<iframe\b/i.test(s)) return s;
      const parser = new DOMParser();
      const doc = parser.parseFromString(s, "text/html");
      const main = doc.querySelector("main");
      if (main) return main.innerHTML;
      if (doc.body) return doc.body.innerHTML || s;
      return s;
    } catch {
      return htmlString;
    }
  }
  function pickHtmlPayload(data, fallback){
    const candidates = [
      data?.html_document, data?.html, data?.content, data?.body,
      data?.answer?.html_document, data?.answer?.html,
      data?.data?.html_document, data?.data?.html,
      data?.json?.html_document, data?.json?.html, fallback
    ].filter(v => typeof v === 'string');

    for (let raw of candidates){
      const dec = /&lt;|&gt;|&amp;|&quot;|&#39;/.test(raw) ? decodeHtmlEntities(raw) : raw;
      if (looksLikeHtml(dec)) return dec;
    }
    return null;
  }

  // edit mode + exports
  let editMode = false;
  const dlHtmlBtn = document.getElementById('downloadHtml');
  const dlPdfBtn  = document.getElementById('downloadPdf');
  const toggleBtn = document.getElementById('toggleEdit');

  function enableExports(on){
    if(!dlHtmlBtn || !dlPdfBtn) return;
    dlHtmlBtn.disabled = !on;
    dlPdfBtn.disabled  = !on;
  }
  function currentResultHTML(){
    const inner = res.innerHTML || '';
    const doc = [
      '<!DOCTYPE html>',
      '<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>result</title></head><body>',
      inner,
      '</body></html>'
    ].join('');
    return doc;
  }
  function downloadHTMLFile(){
    const content = currentResultHTML();
    const blob = new Blob([content], { type: 'text/html;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'result.html';
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
  function downloadPDFFile(){
    const content = currentResultHTML();
    const w = window.open('', '_blank');
    if(!w){ alert('Allow popups to export PDF.'); return; }
    w.document.open();
    w.document.write(content);
    w.document.close();
    w.focus();
    setTimeout(()=>{ w.print(); }, 150);
  }
  function toggleEditMode(){
    editMode = !editMode;
    res.contentEditable = editMode ? "true" : "false";
    res.classList.toggle('editing', !!editMode);
    toggleBtn.textContent = editMode ? 'ìˆ˜ì • ì¢…ë£Œ' : 'ìˆ˜ì • ëª¨ë“œ';
  }
  if (dlHtmlBtn) dlHtmlBtn.addEventListener('click', downloadHTMLFile);
  if (dlPdfBtn)  dlPdfBtn.addEventListener('click',  downloadPDFFile);
  if (toggleBtn) toggleBtn.addEventListener('click', toggleEditMode);

  // send action
  async function send(){
    const topic = q.value.trim();
    if(topic.length < 2){ q.focus(); res.textContent='Please enter at least 2 characters.'; return; }
    loading(true);
    try{
      const r = await postJson(WEBHOOK_URL, { topic });
      if(!r.ok){
        res.textContent = `HTTP ${r.status}\n` + JSON.stringify(r.data,null,2);
        enableExports(false);
        return;
      }
      const ans = r.data?.answer ?? r.data?.data ?? r.data?.raw ?? r.data ?? { ok:true };
      const html = pickHtmlPayload(r.data, typeof ans==='string' ? ans : '');
      if (html){
        const cleaned = decodeHtmlEntities(html);
        const embeddable = extractEmbeddable(cleaned);
        res.innerHTML = embeddable;
        res.style.whiteSpace = 'normal';
        res.style.textAlign = 'left';
        res.style.display = 'block';
        res.style.minHeight = 'auto';
        res.contentEditable = editMode ? "true" : "false";
        res.classList.toggle('editing', !!editMode);
        enableExports(true);
        return;
      }
      res.textContent = (typeof ans==='string') ? ans : JSON.stringify(ans,null,2);
      enableExports(true);
    }catch(e){
      res.textContent = 'Network error: ' + (e?.message || String(e));
      enableExports(false);
    }finally{ loading(false); }
  }
  btn.addEventListener('click', send);
  q.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); send(); }});

  // helpers: rotating 3 topics, clickable
  const helpersEl = document.getElementById('helpers');
  const ROTATE_MS = 12000; // 12s
  let topicPool = [];
  let order = [];
  let cursor = 0;
  let rotateTimer = null;

  function loadTopics(){
    try{
      const raw = document.getElementById('topic-data')?.textContent || '[]';
      const arr = JSON.parse(raw);
      return Array.isArray(arr) ? arr.filter(Boolean) : [];
    }catch{ return []; }
  }
  function shuffle(a){
    const x = a.slice();
    for(let i=x.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [x[i],x[j]] = [x[j],x[i]];
    }
    return x;
  }
  function escHtml(s){
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }
  function escAttr(s){
    return escHtml(s).replace(/"/g,'&quot;').replace(/'/g,'&#39;');
  }
  function nextSet(n=3){
    if(cursor >= order.length){
      order = shuffle(order);
      cursor = 0;
    }
    const idxs = order.slice(cursor, cursor+n);
    cursor += n;
    return idxs.map(i => topicPool[i]);
  }
  function renderHelpers(){
    if(!helpersEl) return;
    const items = nextSet(3);
    helpersEl.innerHTML = items.map(t =>
      `<button class="helper" data-text="${escAttr(t)}">${escHtml(t)}</button>`
    ).join('');
  }
  function startRotate(){
    if(rotateTimer) clearInterval(rotateTimer);
    rotateTimer = setInterval(renderHelpers, ROTATE_MS);
  }
  function initHelpers(){
    topicPool = loadTopics();
    order = topicPool.map((_,i)=>i);
    order = shuffle(order);
    cursor = 0;
    renderHelpers();
    startRotate();
  }
  // click-to-send (event delegation)
  if (helpersEl){
    helpersEl.addEventListener('click', (e)=>{
      const btnEl = e.target.closest('.helper');
      if(!btnEl) return;
      const text = btnEl.getAttribute('data-text') || btnEl.textContent || '';
      q.value = text;
      send();
    });
  }

  // Kakao link generator
  (function(){
    const BASE = 'https://hooks.xn--h32b21du9cf7grcy2k20f.com/webhook/kakao-redirect';
    const key = document.getElementById('k-key');
    const btnMake = document.getElementById('k-make');
    const btnCopy = document.getElementById('k-copy');
    const out = document.getElementById('k-result');

    function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,10); }
    function build(){
      const kw = (key.value || '').trim();
      if(!kw){
        out.textContent = 'í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”';
        out.classList.add('placeholder');
        return;
      }
      const u = uid();
      const qs = new URLSearchParams({ ref: kw, utm_content: u }).toString();
      const url = BASE + (BASE.includes('?') ? '&' : '?') + qs;
      out.innerHTML = `<a href="${url}" target="_blank" rel="noopener">${url}</a>`;
      out.classList.remove('placeholder');
    }
    async function copy(){
      const a = out.querySelector('a');
      const url = a ? a.href : (out.textContent || '').trim();
      if(!/^https?:\/\//.test(url)){
        out.textContent = 'ë¨¼ì € ë§í¬ë¥¼ ìƒì„±í•˜ì„¸ìš”';
        out.classList.add('placeholder');
        return;
      }
      try{
        await navigator.clipboard.writeText(url);
        btnCopy.textContent = 'ë³µì‚¬ ì™„ë£Œ âœ…';
        setTimeout(()=>{ btnCopy.textContent = 'ë³µì‚¬ ğŸ“‹'; }, 1200);
      }catch{
        const t = document.createElement('textarea');
        t.value = url; document.body.appendChild(t); t.select(); document.execCommand('copy'); document.body.removeChild(t);
        btnCopy.textContent = 'ë³µì‚¬ ì™„ë£Œ âœ…';
        setTimeout(()=>{ btnCopy.textContent = 'ë³µì‚¬ ğŸ“‹'; }, 1200);
      }
    }
    if (btnMake) btnMake.addEventListener('click', build);
    if (btnCopy) btnCopy.addEventListener('click', copy);
    if (key) key.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); build(); }});
  })();

  // boot
  document.addEventListener('DOMContentLoaded', initHelpers);
</script>
</body>
</html>
