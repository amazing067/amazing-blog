<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>어메이징사업부 블로그 자동화</title>
  <style>
    :root{ --bg1:#f8fbff; --bg2:#fff7fd; --ink:#111827; --ring:#9b87f5; --accent:#7c3aed; --accent2:#9b87f5; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--ink);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(900px 600px at 12% -8%, var(--bg2), transparent 60%),
        radial-gradient(900px 600px at 108% 8%, #eaf2ff, transparent 55%),
        linear-gradient(180deg, var(--bg1), #fff);
      display:grid;place-items:center;padding:28px;
    }
    .wrap{width:100%;max-width:760px}
    .hero{ text-align:center; margin-bottom:14px; }
    .sticker{
      width:74px;height:74px;margin:0 auto 10px; border-radius:18px;display:grid;place-items:center;overflow:hidden;
      background:linear-gradient(135deg,#fef3c7,#fde68a);border:1px solid #fcd34d;
      box-shadow:inset 0 0 0 3px #ffffffb8,0 10px 26px #f59e0b33;
    }
    .title{
      font-size:28px; font-weight:900; margin:0;
      background:linear-gradient(90deg,#7c3aed,#22d3ee,#7c3aed);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      background-size:200% 100%; animation:shine 4s linear infinite;
      letter-spacing:-0.3px;
    }
    @keyframes shine{0%{background-position:0% 50%}100%{background-position:200% 50%}}

    .card{
      background:#ffffffcc;border:1px solid #eef2ff;border-radius:22px;backdrop-filter:blur(8px);
      box-shadow:0 12px 34px #00000012;padding:20px 18px 16px;
    }

    .ask{
      display:flex;align-items:center;gap:8px;background:#fff;border:1.5px solid #e5e7eb;
      border-radius:999px;padding:10px 10px 10px 14px; box-shadow:0 2px 8px #00000008;
    }
    .ask input{
      flex:1;border:0;outline:none;font-size:15px;background:transparent;
      padding:6px 2px; min-height:22px;
    }
    .send{
      border:0;cursor:pointer; padding:10px 14px;border-radius:999px;color:#fff;
      background:linear-gradient(135deg,var(--accent2),var(--accent));
      box-shadow:0 8px 18px #7c3aed33, inset 0 -6px 12px #00000014;
      display:inline-flex;align-items:center;gap:8px;font-weight:700;
      transition:transform .06s, filter .15s;
    }
    .send:hover{filter:brightness(1.04)}
    .send:active{transform:translateY(1px)}
    .send[disabled]{opacity:.65;cursor:not-allowed}
    .spin{width:16px;height:16px;border-radius:50%;border:2px solid #ffffff80;border-top-color:#fff;display:inline-block;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .helpers{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;justify-content:center}
    .helper{ font-size:12px;border:1px dashed #e5e7eb;background:#fff;border-radius:999px;padding:6px 10px;cursor:pointer; }

    .res{
      margin-top:14px;background:#fff;border:1px solid #eef2ff;border-radius:16px;padding:14px;min-height:130px;
      white-space:pre-wrap;line-height:1.6;
      overflow-wrap:anywhere; word-break:break-word; overflow:auto;
    }
    .placeholder{color:#9ca3af;font-size:14px}
    .status{
      display:flex;align-items:center;gap:10px;font-weight:800;
      background:linear-gradient(90deg,#7c3aed,#22d3ee,#7c3aed);
      -webkit-background-clip:text;background-clip:text;color:transparent;
      background-size:200% 100%;animation:shine 3s linear infinite;
    }
    .test-indicator{position:fixed;top:10px;right:10px;background:#ff6b35;color:#fff;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:bold;z-index:1000;}
    .res.editing{ outline:2px dashed #9b87f5; box-shadow: inset 0 0 0 3px #f3f0ff; }

    /* exporters */
    #exporters{ border-top:1px dashed #e5e7eb; margin-top:12px; padding-top:12px; position:relative; }
    #exporters::before{ content:""; position:absolute;left:0;right:0;top:-1px;height:1px;
      background:linear-gradient(90deg,#ffffff00,#e5e7eb,#ffffff00); }
    .chip{ border:0; cursor:pointer; padding:8px 12px; border-radius:999px; color:#fff; font-weight:700;
      display:inline-flex; align-items:center; gap:6px; box-shadow:0 8px 18px #00000014, inset 0 -6px 12px #0000000f;
      transition:transform .06s, filter .15s; }
    .chip:hover{ filter:brightness(1.06); }
    .chip:active{ transform:translateY(1px); }
    .chip:disabled{ opacity:.55; cursor:not-allowed; }
    .chip-edit{ background:linear-gradient(135deg,#8b5cf6,#6d28d9); }
    .chip-html{ background:linear-gradient(135deg,#14b8a6,#0ea5e9); }
    .chip-pdf { background:linear-gradient(135deg,#f43f5e,#fb7185); }

    /* 카테고리 */
    #catHeader{ display:flex; align-items:center; justify-content:center; gap:10px; margin-top:14px; }
    #catBadge{
      font-size:12px; font-weight:900; letter-spacing:.6px;
      padding:6px 12px; border-radius:999px; color:#4c1d95; background:#ede9fe; border:1px solid #ddd6fe;
    }
    #tabWrap{ display:flex; justify-content:center; margin-top:8px; }
    #tabs{
      position:relative; display:flex; gap:8px; padding:10px; border-radius:999px;
      background:linear-gradient(180deg,#ffffff,#f8fafc);
      border:1px solid #e5e7eb; box-shadow:0 8px 20px #00000010; overflow:auto; max-width:100%;
    }
    .tab{
      position:relative;
      border:0; background:transparent; color:#334155;
      padding:10px 14px; border-radius:999px; font-size:13px; cursor:pointer;
      display:inline-flex; align-items:center; gap:6px; font-weight:800;
      transition:color .2s ease, transform .06s; white-space:nowrap;
    }
    .tab .ico{ font-style:normal; }
    .tab.active{
      color:#fff;
      background:linear-gradient(135deg,#7c3aed,#22d3ee);
      box-shadow:0 10px 20px #7c3aed33;
    }

    /* 도구 패널 */
    #toolsWrap{ margin-top:12px; }
    #toolsToggle{
      width:100%; border:1px dashed #e5e7eb; background:#fff; color:#334155;
      border-radius:12px; padding:10px 12px; cursor:pointer; font-weight:900;
      display:flex; align-items:center; justify-content:center; gap:8px;
      box-shadow:0 6px 14px #0000000b;
    }
    #toolsToggle .chev{ transition:transform .2s ease; }
    #toolsToggle.open .chev{ transform:rotate(180deg); }
    #toolsPanel{
      overflow:hidden; transition:max-height .3s ease, opacity .2s ease;
      max-height:0; opacity:0;
    }
    #toolsPanel.open{ max-height:360px; opacity:1; }

    /* 서식 툴바 */
    #toolbar{
      margin-top:10px; padding:10px; border:1px dashed #e5e7eb; border-radius:12px;
      background:linear-gradient(180deg,#ffffff,#fafbff);
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center;
    }
    .tool{
      border:0; cursor:pointer; border-radius:10px; padding:8px 10px; font-size:12px; font-weight:700;
      color:#fff; display:inline-flex; align-items:center; gap:6px;
      box-shadow:0 6px 14px #00000010, inset 0 -6px 12px #0000000f;
      transition:transform .06s, filter .15s;
    }
    .tool:hover{ filter:brightness(1.06); }
    .tool:active{ transform:translateY(1px); }
    .tool[disabled]{ opacity:.55; cursor:not-allowed; }
    .t-bold{ background:linear-gradient(135deg,#111827,#4b5563); }
    .t-italic{ background:linear-gradient(135deg,#6b7280,#9ca3af); }
    .t-underline{ background:linear-gradient(135deg,#0ea5e9,#38bdf8); }
    .t-h2{ background:linear-gradient(135deg,#16a34a,#22c55e); }
    .t-h3{ background:linear-gradient(135deg,#10b981,#34d399); }
    .t-ul{ background:linear-gradient(135deg,#fb923c,#f59e0b); }
    .t-ol{ background:linear-gradient(135deg,#f97316,#ea580c); }
    .t-left{ background:linear-gradient(135deg,#818cf8,#6366f1); }
    .t-center{ background:linear-gradient(135deg,#a78bfa,#8b5cf6); }
    .t-right{ background:linear-gradient(135deg,#c4b5fd,#a78bfa); }
    .t-link{ background:linear-gradient(135deg,#6366f1,#8b5cf6); }
    .t-color{ background:linear-gradient(135deg,#ef4444,#eab308,#22c55e,#3b82f6,#8b5cf6); color:#111827; font-weight:800; }
    .color-picker{ appearance:none; width:28px; height:28px; border-radius:8px; border:1px solid #e5e7eb; padding:0; }
    .color-picker::-webkit-color-swatch{ border:none; border-radius:8px; }

    /* 폰트 컨트롤 */
    #fontBox{ margin-top:8px; display:flex; justify-content:center; align-items:center; gap:8px; }
    #fontBox .btn{ padding:6px 10px; border-radius:8px; border:1px dashed #e5e7eb; background:#fff; cursor:pointer; }
    #fontBox .val{ font-weight:800; color:#334155; min-width:50px; text-align:center; }

    /* 이미지 리사이즈 */
    .img-selected{ outline:2px solid #7c3aed; outline-offset:2px; }
    .img-handle{
      position:absolute; width:12px; height:12px; border-radius:50%;
      background:#7c3aed; box-shadow:0 2px 6px #00000033; cursor:nwse-resize;
      right:-6px; bottom:-6px; z-index:2;
    }
    .img-fab{
      position:absolute; transform:translate(-50%,-100%); left:50%; top:0;
      background:#111827; color:#fff; padding:8px 10px; border-radius:12px;
      box-shadow:0 10px 24px #00000033; display:flex; align-items:center; gap:8px; z-index:2;
    }
    .img-fab input[type="range"]{ width:120px; }
    .img-fab button{ border:0; border-radius:999px; padding:6px 8px; cursor:pointer; font-weight:800; }
    .img-fab .p50{ background:#fde68a; }
    .img-fab .p75{ background:#a7f3d0; }
    .img-fab .p100{ background:#bfdbfe; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="sticker" aria-hidden="true">
        <svg viewBox="0 0 80 80" width="58" height="58">
          <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#fef3c7"/><stop offset="1" stop-color="#fde68a"/></linearGradient></defs>
        <circle cx="40" cy="40" r="28" fill="url(#g)" stroke="#fbbf24" stroke-width="2"/>
        <circle cx="32" cy="35" r="4" fill="#1f2937"/><circle cx="48" cy="35" r="4" fill="#1f2937"/>
        <path d="M28 49 Q40 58 52 49" stroke="#1f2937" stroke-width="3" fill="none" stroke-linecap="round"/>
        <path d="M18 26 26 18 M54 18 62 26" stroke="#f59e0b" stroke-width="3" stroke-linecap="round"/>
        </svg>
      </div>
      <h1 class="title">어메이징사업부 블로그 자동화</h1>
    </div>

    <!-- 카카오 링크 생성기 -->
    <div class="card" id="chat-link-maker">
      <label style="display:block;font-size:14px;font-weight:800;margin-bottom:10px">카카오톡 블로그 채널링크 🔗</label>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="k-key" type="text" placeholder=""
               style="flex:1;padding:12px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;outline:none"/>
        <button id="k-make" class="send" type="button">생성 ✨</button>
      </div>
      <div style="display:flex;align-items:center;gap:8px;margin-top:10px">
        <div id="k-result" class="placeholder" style="flex:1;word-break:break-all">결과 링크가 여기에 표시됩니다</div>
        <button id="k-copy" class="send" type="button" style="white-space:nowrap">복사 📋</button>
      </div>
    </div>

    <div class="card">
      <div class="ask">
        <input id="q" autocomplete="off" placeholder="주제를 입력하세요" />
        <button id="send" class="send" type="button"><span id="sendLabel">Send</span> 🚀</button>
      </div>

      <!-- 카테고리 -->
      <div id="catHeader"><span id="catBadge">카테고리</span></div>
      <div id="tabWrap"><div class="helpers" id="tabs"><!-- tabs inject --></div></div>

      <!-- 3개 로테이션 헬퍼 -->
      <div class="helpers" id="helpers"></div>

      <!-- 내보내기 -->
      <div class="helpers" id="exporters">
        <button class="chip chip-edit" id="toggleEdit" data-on="수정 종료" data-off="수정 모드">수정 모드</button>
        <button class="chip chip-html" id="downloadHtml" disabled>HTML 저장</button>
        <button class="chip chip-pdf"  id="downloadPdf"  disabled>PDF 저장</button>
      </div>

      <!-- 도구 패널 -->
      <div id="toolsWrap">
        <button id="toolsToggle">
          <span class="chev">▾</span> <span>✦ 도구 패널</span>
        </button>
        <div id="toolsPanel">
          <div id="toolbar" class="helpers">
            <button class="tool t-bold"      data-cmd="bold">굵게</button>
            <button class="tool t-italic"    data-cmd="italic">기울임</button>
            <button class="tool t-underline" data-cmd="underline">밑줄</button>
            <button class="tool t-h2"        data-cmd="formatBlock" data-val="H2">H2</button>
            <button class="tool t-h3"        data-cmd="formatBlock" data-val="H3">H3</button>
            <button class="tool t-ul"        data-cmd="insertUnorderedList">목록</button>
            <button class="tool t-ol"        data-cmd="insertOrderedList">번호</button>
            <button class="tool t-left"      data-cmd="justifyLeft">왼쪽</button>
            <button class="tool t-center"    data-cmd="justifyCenter">가운데</button>
            <button class="tool t-right"     data-cmd="justifyRight">오른쪽</button>
            <button class="tool t-link"      id="mkLink">링크</button>
            <label class="tool t-color" style="gap:8px;">
              색상 <input type="color" id="foreColor" class="color-picker" value="#333333" title="텍스트 색상"/>
            </label>
          </div>

          <!-- 전역 글씨크기 (A-/A+) -->
          <div id="fontBox" class="helpers">
            <button class="btn" id="fontDown">A-</button>
            <span class="val" id="fontVal">100%</span>
            <button class="btn" id="fontUp">A+</button>
          </div>
        </div>
      </div>

      <div id="res" class="res"><div class="placeholder">결과는 여기에 표시됩니다</div></div>
    </div>
  </div>

  <!-- 카테고리별 주제 JSON -->
  <script type="application/json" id="topic-categories">{
    "실손보험": ["실손보험 청구서류 목록 2025","실손보험 청구 방법 앱/병원 비교","실손보험 통원비 청구 기준","실손보험 비급여 주사 보장 여부","도수치료 실손보험 청구 가능 기준","MRI/MRA 실손보험 인정 범위","초음파/내시경 실손보험 적용?","치과 스케일링 실손 보장 되는지","한의원 치료 실손 청구 요령","약제비 실손보험 청구 절차","전자영수증·처방전 분실 대처","실손보험 공제금·자기부담 계산","표준화 실손 vs 신규실손 차이","실손보험 갱신 주기·인상 요인","실손 특약 최소/권장 구성","실손보험 합산한도·중복가입 주의","스마트청구 앱 사용법 비교","실손 청구기한·심사 기간","부지급 빈번 사유 Top10","입원의료비/통원의료비 차이","의무기록사본·진단서 준비","비급여 코드 확인 방법","해외 진료 실손 청구 가능?","도우미·간병비 보장 여부","질병/상해 구분 체크리스트","치료비 선결제 후 청구 팁","실손 보상비율 계산 예시","이중 청구 방지 체크포인트","실손 재가입·전환 시 유의점","실손보험 해지·유지 판단 가이드"],
    "암보험": ["암보험 진단비 지급조건 핵심","유사암 보장 범위·예외 조항","갑상선암 소액암 기준 2025","기타피부암 코드·청구 포인트","표적항암·면역항암 보장 구조","항암 방사선/수술 보장 비교","암 산정특례 신청·서류 안내","입원일당·수술비 특약 구성법","재진단암 보장 조건 체크","항암 부작용 보장(오심·탈모 등)","갱신형 vs 비갱신형 비교","무해지환급형 장단점","여성암 특약(유방·자궁) 비교","남성암 특약(전립선 등) 체크","가족력 있을 때 가입 팁","가입 전 고지사항 체크리스트","부지급 자주 나오는 사례","암진단 코드 체계 이해","표적치료제 본인부담 사례","면역항암 급여/비급여 차이","암 치료비 절감 꿀팁","보험료 인상 요인·관리법","특약 간 중복 보장 주의","치료 후 추가검사 보장","유사암→일반암 전환 케이스","치료 중 이사·병원 변경 청구","완치 후 재가입 가능 여부","어린이 암보험 체크포인트","고령자 암보험 가입 가능?","암보험 약관 읽는 법"],
    "운전자보험": ["운전자보험 특약 최소 구성 가이드","형사합의금·변호사비용 보장 범위","교통사고처리지원금 지급조건","벌점/면허정지·취소 보장 여부","음주·무면허 면책 조항 정리","스쿨존 사고 특약 체크","자전거·킥보드 사고 보장 확인","대물·대인 차이와 한도","초과책임 보장 점검 리스트","과실비율별 처리 요령","뺑소니 가해/피해 보장 차이","합의 절차·필요 서류","특약별 권장 가입금액","자기부담금 구조 이해","가족운전자 범위 설정법","자동차상해 vs 자동차보험 차이","택시·대리운전 종사자 특약","갱신/해지 판단 기준","벌금 보장 한도·예외","중상해처벌법 관련 쟁점","대리기사 사고 처리","주정차 사고 처리 요령","차대사람 사고 합의 팁","렌트카·카셰어링 보장","무단횡단 사고 대응법","블랙박스 증거 보존 팁","사고 후 진단서 준비","초보운전 필수 특약","신차 출고 전 체크리스트","운전자보험 보험료 아끼는 법"],
    "장기요양/간병": ["장기요양 등급 판정 기준 총정리","장기요양 인정점수 계산 방법","등급별 이용 서비스·수가","방문요양/목욕/간호 차이","요양병원 vs 요양원 비교","가족요양 인정 조건","본인부담금 계산·감면 제도","간병인 비용 현실·보장 여부","간병인보험 핵심 특약","치매 등급·지원 제도 한눈에","장기요양 재판정 준비 서류","돌봄서비스 지역 지원 찾기","환자이송 서비스 비용/보장","의사 소견서·진단서 준비","수급자/보호자 체크리스트","지급정지·변경 사유 정리","요양서비스 불만 처리 절차","재활치료 병행 비용 보장","간병 소모품 지원 안내","등급탈락 시 대처법","가정간호보험 활용 팁","장기요양보험료 산정 방식","요양 중 이사·이관 절차","대상자 부재 시 처리","건보공단 신청 절차 요약","공단 전화/방문 팁","방문요양 기관 선택 기준","야간·24시간 간병 비용","가사·돌봄 바우처 활용","간병인 계약서·분쟁 예방"],
    "해외여행보험": ["해외여행보험 보장 범위 총정리","해외 치료비 청구 절차·서류","항공기 지연·결항 보장 한도","수하물 분실/파손 보장 기준","여권 분실 시 긴급조치·보장","감염병(코로나 등) 보장 여부","임신 중 여행 보장 유의사항","레저·스포츠 특약 필요 체크","해외 병원 영문서류 준비","현지 병원 찾는 법·연락처","자기부담금·보장한도 설정","동반가족 보장 범위","장기 체류 여행자보험 선택법","워홀·유학 보험 체크리스트","해외 약국 이용 팁","영문진단서 발급 방법","귀국 후 보험금 청구 서류","현지 결제/환불 처리","해외 렌트카 사고 처리","여행 중 도난 신고·보장","질병 악화 면책 조항","만성질환 복용약 준비","휴대품 한도·예외 품목","여행 취소비용 보장","고지의무 위반 주의사항","산행/스쿠버 보장 특약","모바일 청구 방법","경유 지연 보장 팁","비자/입국 제한 확인","해외 의료비 견적 비교"],
    "뇌·심혈관": ["뇌졸중 vs 뇌출혈 보장 차이","심근경색·허혈성심질환 보장","협심증 보장 가능 범위","스텐트 시술 보장 체크","심전도·Troponin 기준 이해","MRI/MRA 급여·비급여 구분","응급실 내원 기록의 중요성","후유장해 평가·지급 절차","재활치료 비용 보장 여부","고혈압·고지혈증 고지사항","심장재활 프로그램 보장","뇌 MRI 코드·청구 포인트","CT vs MRI 선택 가이드","뇌혈관 진단금 지급요건","심근경색 진단금 예시","뇌졸중 후유증 관리·보장","뇌혈관 수술비 특약","심장 스텐트 갱신 이슈","병상·중환자실 보장 여부","구급차 이송비 청구","약물치료·재발 리스크","퇴원 후 통원치료 청구","건강검진 이상소견 대응","운전 재개 시점·서류","장기복용 약 비용 보장","생활습관 관리·할인 특약","산재/교통사고 중복 보장","질병코드 I21/I63 이해","보험료 절감 특약 활용","가족력 있을 때 가입 팁"],
    "치아보험": ["치아보험 임플란트 보장 한도","크라운·브릿지 보장 조건","레진 충전 보장 가능 여부","스케일링 보장 주기·횟수","사랑니 발치 보장되는가","치주치료 보장 범위","신경치료 보장 기준","틀니 보장 및 한도","임플란트 개수 제한 규정","교정 치료 보장되는지","치아사고 보장과 서류","치아보험 면책기간 안내","치과 진단서·영수증 준비","치과 실손과 중복 보장","영구치/유치 보장 차이","치근단 수술 보장 여부","치석제거 보장 기준","치은염·치주염 보장","임플란트 유지관리 보장","치과 마취·진정 보장","임플란트 재시술 보장","치아 파절 응급치료 보장","치아미백 보장 여부","스케일링 추가 비용","파노라마·CT 촬영 보장","치과 치료 코드 이해","치과 내원일당 특약","치아보험 갱신/비갱신 비교","무해지환급형 치아보험","가족형/자녀형 선택 팁"],
    "어린이보험": ["어린이보험 가입 적정 시기","태아보험·어린이보험 차이","선천성질환 보장 여부","재해·질병 입원일당 구성","골절/깁스 특약 비교","응급실 내원비 보장","치과치료 보장 범위","아토피·천식 보장 가능?","ADHD 관련 보장 유의","백신 이상반응 보장","학생배상책임 특약","통학 중 사고 보장","어린이 암특약 구성","백혈병 진단비 체크","수술비/입원비 조합","상해후유장해 지급기준","응급수술비 보장","식중독/인플루엔자 보장","소아과 검사비 보장","치아보장과 중복 체크","실손 연계 가입 팁","자가격리/감염 보장 여부","놀이시설 사고 보장","학교안전공제 중복","스포츠 활동 보장","만기환급형 선택 요령","부모 동반 사고 보장","정신건강 관련 유의","갱신/비갱신 비교","보험료 절감 팁"],
    "실버보험": ["실버보험 가입 연령·심사","유병자 특약·간편심사","고지 완화형 가입 요령","치매 진단비/간병비 보장","장기요양 등급 연계 보장","낙상·골절 보장 체크","입원일당·수술비 구성","재해사망/후유장해 보장","요양원 비용 보장","만성질환 보장 범위","투석·심장시술 보장 여부","당뇨·고혈압 유의사항","갱신형 vs 비갱신형","해지환급금 구조 이해","보험료 인상 관리법","고령 운전자 특약","배우자 동시 가입 팁","간병인 지원 특약","치매 예방 프로그램 보장","상조서비스 연계 여부","사전연명의료의향서와 보험","와상상태 지급 기준","호스피스 보장","응급실 내원비","검사비·소모품 보장","독거노인 안심 특약","골다공증 관련 보장","재가입/전환 시 유의","보장 공백 줄이기","상해/질병 면책 주의"],
    "반려동물보험": ["반려동물보험 보장 범위 총정리","질병/상해 보장 차이","예방접종·중성화 보장 여부","슬개골 탈구 보장되는가","피부질환 보장 범위","유전질환 보장 제한","자기부담금·한도 선택법","동물병원 직접청구 방법","다마리(다펫) 할인","강아지 vs 고양이 보장 차이","치과·스케일링 보장","정밀검사 보장 기준","입원/수술 보장 요건","장기약 복용 보장","특정 품종 유의사항","예상 보험료 계산 팁","갱신/해지 시 유의","해외여행 반려동물 보장","유기·분실 등록 절차","반려동물 등록증 서류","행동교정 보장 여부","장례/화장 보장 여부","사고 책임배상 보장","훈련 비용 보장?","산책 중 사고 보장","교상(물림) 사고 처리","이동장/케이지 파손","입양 초기 질병 면책","노령 반려견 가입","보험금 청구 서류"]
  }</script>

<script>
 // ===== 공통 =====
function isTestMode(){ return location.search.includes('test=true') || location.search.includes('debug=true'); }
const HOOKS_BASE='https://hooks.xn--h32b21du9cf7grcy2k20f.com';
const WF_PATH='ask';

// 하나의 엔드포인트만 사용
const BASE_URL = `${HOOKS_BASE}/webhook/${WF_PATH}`;
// test 모드일 때는 항상 새 요청으로 나가도록 캐시 무효 파라미터 추가
const WEBHOOK_URL = isTestMode() ? `${BASE_URL}?_t=${Date.now()}` : BASE_URL;

// 표시만 test 모드 안내
if (isTestMode()){
  const ind=document.createElement('div');
  ind.className='test-indicator';
  ind.textContent='TEST MODE (prod webhook 사용)';
  document.body.appendChild(ind);
}

  const $=(s)=>document.querySelector(s);
  const q=$('#q'), btn=$('#send'), res=$('#res'), sendLabel=$('#sendLabel');

  function loading(on){
    if(on){ btn.disabled=true; sendLabel.innerHTML='<span class="spin"></span>'; res.innerHTML='<div class="status"><span class="spin"></span>AI is working…</div>'; }
    else { btn.disabled=false; sendLabel.textContent='Send'; }
  }

  // 타임아웃 10분 + CORS 모드 명시
  /* ▼▼▼ postJson에 credentials 분기 추가 ▼▼▼ */
  async function postJson(url, body, timeoutMs=600000, withCredentials=false){
    const controller=new AbortController();
    const t=setTimeout(()=>controller.abort(), timeoutMs);
    try{
      const r=await fetch(url,{
        method:'POST',
        mode:'cors',
        credentials: withCredentials ? 'include' : 'omit',
        headers:{
          'Content-Type':'application/json',
          'Accept':'application/json, text/plain, */*'
        },
        body:JSON.stringify(body),
        signal:controller.signal
      });
      const text=await r.text();
      let data; try{ data=JSON.parse(text); } catch{ data={ raw:text }; }
      return { ok:r.ok, status:r.status, data };
    } finally { clearTimeout(t); }
  }
  /* ▲▲▲ 수정 끝 ▲▲▲ */

  function looksLikeHtml(s){ return /^\s*<(?:!DOCTYPE|html|body|main|div|section|article|h1|h2|p|iframe)\b/i.test(s||""); }
  function decodeHtmlEntities(str){ if(typeof str!=='string') return str; const el=document.createElement('textarea'); el.innerHTML=str; return el.value; }
  function extractEmbeddable(htmlString){
    try{
      const s=String(htmlString||"");
      const m=s.match(/^\s*<iframe\b[^>]*\bsrcdoc=(["'])([\s\S]*?)\1[^>]*>\s*<\/iframe>\s*$/i);
      if(m){ const ta=document.createElement('textarea'); ta.innerHTML=m[2]; return ta.value; }
      if(/^\s*<iframe\b/i.test(s)) return s;
      const parser=new DOMParser(); const doc=parser.parseFromString(s,'text/html');
      const main=doc.querySelector('main'); if(main) return main.innerHTML;
      if(doc.body) return doc.body.innerHTML || s;
      return s;
    }catch{ return htmlString; }
  }
  function pickHtmlPayload(data, fallback){
    const candidates=[
      data?.html_document,data?.html,data?.content,data?.body,
      data?.answer?.html_document,data?.answer?.html,
      data?.data?.html_document,data?.data?.html,
      data?.json?.html_document,data?.json?.html,
      fallback
    ].filter(v=>typeof v==='string');
    for(let raw of candidates){
      const dec=/&lt;|&gt;|&amp;|&quot;|&#39;/.test(raw)?decodeHtmlEntities(raw):raw;
      if(looksLikeHtml(dec)) return dec;
    }
    return null;
  }

  // ===== 수정 모드 & 내보내기 =====
  let editMode=false;
  const dlHtmlBtn=$('#downloadHtml'), dlPdfBtn=$('#downloadPdf'), toggleBtn=$('#toggleEdit'), toolbar=$('#toolbar');

  function resultExists(){
    const html=(res.innerHTML||'').trim();
    if(!html) return false;
    return !/결과는 여기에 표시됩니다/.test(html);
  }
  function enableExports(on){
    const enable = on && resultExists();
    if(dlHtmlBtn) dlHtmlBtn.disabled=!enable;
    if(dlPdfBtn)  dlPdfBtn.disabled=!enable;
  }

  function currentResultHTML(){
    const inner=res.innerHTML||'';
    return '<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>result</title></head><body>'+inner+'</body></html>';
  }
  function downloadHTMLFile(){ if(!resultExists()) return;
    const blob=new Blob([currentResultHTML()],{type:'text/html;charset=utf-8'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='result.html'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }
  function downloadPDFFile(){ if(!resultExists()) return;
    const w=window.open('','_blank'); if(!w){ alert('팝업을 허용해주세요.'); return; }
    w.document.open(); w.document.write(currentResultHTML()); w.document.close(); w.focus(); setTimeout(()=>w.print(),150);
  }
  function toggleEditMode(){
    editMode=!editMode;
    res.contentEditable=editMode?"true":"false";
    res.classList.toggle('editing',!!editMode);
    const onLabel=toggleBtn.getAttribute('data-on')||'수정 종료';
    const offLabel=toggleBtn.getAttribute('data-off')||'수정 모드';
    toggleBtn.textContent=editMode?onLabel:offLabel;
    [...toolbar.querySelectorAll('.tool,.color-picker')].forEach(el=>el.disabled=!editMode);
  }
  dlHtmlBtn.addEventListener('click', downloadHTMLFile);
  dlPdfBtn .addEventListener('click', downloadPDFFile);
  toggleBtn.addEventListener('click', toggleEditMode);
  [...toolbar.querySelectorAll('.tool,.color-picker')].forEach(el=>el.disabled=true);

  // ===== 전송 =====
  async function send(){
    const topic=q.value.trim(); if(topic.length<2){ q.focus(); res.textContent='Please enter at least 2 characters.'; enableExports(false); return; }
    loading(true);
    try{
      /* ▼▼▼ 엔드포인트/크레덴셜 분기 ▼▼▼ */
      const ENDPOINT = currentEndpoint();
      const WITH_CREDS = !isTestMode(); // test(webhook-test)=omit, prod(webhook)=include
      const r=await postJson(ENDPOINT,{topic}, 600000, WITH_CREDS);
      /* ▲▲▲ 분기 끝 ▲▲▲ */
      if(!r.ok){
        res.textContent=`HTTP ${r.status}\n`+JSON.stringify(r.data,null,2);
        enableExports(false); return;
      }
      const ans=r.data?.answer ?? r.data?.data ?? r.data?.raw ?? r.data ?? {ok:true};
      const html=pickHtmlPayload(r.data, typeof ans==='string'?ans:'');
      if(html){
        const cleaned=decodeHtmlEntities(html); const emb=extractEmbeddable(cleaned);
        res.innerHTML=emb; res.style.whiteSpace='normal'; res.style.textAlign='left'; res.style.display='block'; res.style.minHeight='auto';
        res.contentEditable=editMode?"true":"false"; res.classList.toggle('editing',!!editMode);
        attachResizeToImages(); enableExports(true);
        return;
      }
      res.textContent=(typeof ans==='string')?ans:JSON.stringify(ans,null,2);
      enableExports(true);
    }catch(e){
      res.textContent='Network error: '+(e?.message||String(e));
      enableExports(false);
    }finally{ loading(false); }
  }
  btn.addEventListener('click', send);
  q.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); send(); }});

  // ===== 카테고리 탭 + 3개 로테이션 =====
  const tabsEl=$('#tabs'), helpersEl=$('#helpers'); const ROTATE_MS=12000;
  let categories={}, catNames=[], currentCat=null, order=[], cursor=0, rotateTimer=null;

  function loadCategories(){ try{ const raw=$('#topic-categories')?.textContent||'{}'; const obj=JSON.parse(raw); return obj&&typeof obj==='object'?obj:{}; }catch{ return {}; } }
  function shuffle(a){ const x=a.slice(); for(let i=x.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [x[i],x[j]]=[x[j],x[i]]; } return x; }
  function escHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  function escAttr(s){ return escHtml(s).replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

  function renderTabs(){
    const icons=["🏷️","📑","🚗","🧓","✈️","❤️","🦷","🧒","👵","🐶"];
    tabsEl.innerHTML = catNames.map((c,i)=>
      `<button class="tab ${i===0?'active':''}" data-cat="${escAttr(c)}"><span class="ico">${icons[i%icons.length]}</span>${escHtml(c)}</button>`
    ).join('');
    currentCat=catNames[0]||null; resetRotation();
  }
  function resetRotation(){
    const pool=(categories[currentCat]||[]); order=shuffle(pool.map((_,i)=>i)); cursor=0; renderHelpers();
    if(rotateTimer) clearInterval(rotateTimer); rotateTimer=setInterval(renderHelpers, ROTATE_MS);
  }
  function nextSet(n=3){
    const pool=(categories[currentCat]||[]); if(pool.length===0) return [];
    if(cursor>=order.length){ order=shuffle(order); cursor=0; }
    const idxs=order.slice(cursor, cursor+n); cursor+=n; return idxs.map(i=>pool[i]);
  }
  function renderHelpers(){ const items=nextSet(3); helpersEl.innerHTML=items.map(t=>`<button class="helper" data-text="${escAttr(t)}">${escHtml(t)}</button>`).join(''); }
  tabsEl.addEventListener('click',(e)=>{
    const tab=e.target.closest('.tab'); if(!tab) return;
    tabsEl.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    tab.classList.add('active');
    currentCat=tab.getAttribute('data-cat');
    resetRotation();
  });
  if(helpersEl){ helpersEl.addEventListener('click',(e)=>{ const b=e.target.closest('.helper'); if(!b) return; q.value=b.getAttribute('data-text')||b.textContent||''; }); }

  // ===== 툴바 명령 =====
  function applyCmd(cmd,val=null){ if(!editMode) toggleEditMode(); document.execCommand(cmd,false,val); res.focus(); }
  $('#toolbar').addEventListener('click',(e)=>{
    const b=e.target.closest('.tool'); if(!b) return;
    if(b.id==='mkLink'){ const url=prompt('링크 URL을 입력하세요'); if(url && /^https?:\/\//i.test(url)) applyCmd('createLink',url); return; }
    const cmd=b.getAttribute('data-cmd'); const val=b.getAttribute('data-val'); if(cmd) applyCmd(cmd,val);
  });
  $('#foreColor').addEventListener('input',(e)=>{ applyCmd('foreColor', e.target.value); });

  // ===== 전역 글씨 크기(80–180%) =====
  const FONT_MIN=80, FONT_MAX=180;
  let globalFont=100;
  function clamp(v,min,max){ return Math.max(min, Math.min(max,v)); }
  function applyGlobalFont(){
    globalFont=clamp(globalFont, FONT_MIN, FONT_MAX);
    res.style.fontSize=globalFont+'%';
    $('#fontVal').textContent=globalFont+'%';
  }
  $('#fontDown').addEventListener('click', ()=>{ globalFont=clamp(globalFont-10,FONT_MIN,FONT_MAX); applyGlobalFont(); });
  $('#fontUp').addEventListener('click',   ()=>{ globalFont=clamp(globalFont+10,FONT_MIN,FONT_MAX); applyGlobalFont(); });

  // ===== 이미지 드래그&드롭/붙여넣기 + 리사이즈 =====
  function insertAtCaret(node){
    const sel=window.getSelection();
    if(sel && sel.rangeCount && res.contains(sel.anchorNode)){
      const range=sel.getRangeAt(0); range.deleteContents(); range.insertNode(node); range.collapse(false); sel.removeAllRanges(); sel.addRange(range);
    } else { res.appendChild(node); }
  }
  function handleFiles(files){
    if(!files || !files.length) return;
    if(!editMode) toggleEditMode();
    [...files].forEach(file=>{
      if(!file.type.startsWith('image/')) return;
      const reader=new FileReader();
      reader.onload=()=>{
        const img=new Image(); img.src=reader.result; img.style.maxWidth='100%'; img.style.height='auto'; img.style.display='block'; img.style.margin='8px 0';
        insertAtCaret(img); attachResizeToImage(img);
      };
      reader.readAsDataURL(file);
    });
  }
  const resEl=res;
  resEl.addEventListener('dragover', (e)=>{ e.preventDefault(); resEl.classList.add('editing'); });
  resEl.addEventListener('dragleave', ()=>{ resEl.classList.toggle('editing', !!editMode); });
  resEl.addEventListener('drop', (e)=>{ e.preventDefault(); handleFiles(e.dataTransfer.files); resEl.classList.toggle('editing', !!editMode); });
  resEl.addEventListener('paste', (e)=>{
    const items=e.clipboardData && e.clipboardData.items; if(!items) return;
    const imgs=[]; for(const it of items){ if(it.type && it.type.indexOf('image/')===0) imgs.push(it.getAsFile()); }
    if(imgs.length){ e.preventDefault(); handleFiles(imgs); }
  });

  let currentImg=null, handleEl=null, fabEl=null, startX=0, startW=0;
  function attachResizeToImages(){ res.querySelectorAll('img').forEach(attachResizeToImage); }
  function attachResizeToImage(img){
    img.style.cursor='pointer';
    img.addEventListener('click', (e)=>{ e.stopPropagation(); selectImage(img); });
  }
  function selectImage(img){
    if(currentImg===img){ showFab(img); return; }
    clearImageUI();
    currentImg=img; img.classList.add('img-selected'); showHandle(img); showFab(img);
  }
  function clearImageUI(){
    if(currentImg) currentImg.classList.remove('img-selected');
    if(handleEl){ handleEl.remove(); handleEl=null; }
    if(fabEl){ fabEl.remove(); fabEl=null; }
    currentImg=null;
  }
  document.addEventListener('click',(e)=>{ if(!res.contains(e.target)) clearImageUI(); });

  function showHandle(img){
    handleEl=document.createElement('div'); handleEl.className='img-handle';
    img.style.position='relative'; img.parentElement.style.position='relative';
    img.parentElement.appendChild(handleEl);

    handleEl.addEventListener('mousedown',(e)=>{
      e.preventDefault();
      startX=e.clientX; startW=img.getBoundingClientRect().width;
      const onMove=(me)=>{
        const dx=me.clientX-startX;
        const newW=Math.max(50, startW+dx);
        const parentW=img.parentElement.getBoundingClientRect().width||newW;
        const pct=Math.round((newW/parentW)*100);
        img.style.width=pct+'%'; img.style.maxWidth='100%';
        updateFab(pct);
      };
      const onUp=()=>{ document.removeEventListener('mousemove',onMove); document.removeEventListener('mouseup',onUp); };
      document.addEventListener('mousemove',onMove); document.addEventListener('mouseup',onUp);
    });
  }
  function showFab(img){
    if(fabEl) fabEl.remove();
    fabEl=document.createElement('div'); fabEl.className='img-fab';
    const parentW=img.parentElement.getBoundingClientRect().width||img.width;
    const curPct=Math.round((img.getBoundingClientRect().width/parentW)*100)||100;
    fabEl.innerHTML=`
      <input type="range" min="10" max="100" value="${Math.max(10, Math.min(100, curPct))}">
      <button class="p50">50%</button>
      <button class="p75">75%</button>
      <button class="p100">100%</button>
    `;
    img.parentElement.style.position='relative';
    img.parentElement.appendChild(fabEl);

    const range=fabEl.querySelector('input[type="range"]');
    range.addEventListener('input',(e)=>{ const v=parseInt(e.target.value,10); img.style.width=v+'%'; updateFab(v); });
    fabEl.querySelector('.p50').addEventListener('click',()=>{ img.style.width='50%'; updateFab(50); });
    fabEl.querySelector('.p75').addEventListener('click',()=>{ img.style.width='75%'; updateFab(75); });
    fabEl.querySelector('.p100').addEventListener('click',()=>{ img.style.width='100%'; updateFab(100); });
  }
  function updateFab(pct){
    const range=fabEl?.querySelector('input[type="range"]'); if(range) range.value=Math.max(10,Math.min(100,pct));
  }

  // 카카오 링크 생성기
  (function(){
    const BASE='https://hooks.xn--h32b21du9cf7grcy2k20f.com/webhook/kakao-redirect';
    const key=$('#k-key'); const btnMake=$('#k-make'); const btnCopy=$('#k-copy'); const out=$('#k-result');
    function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,10); }
    function build(){
      const kw=(key.value||'').trim();
      if(!kw){ out.textContent='키워드를 입력하세요'; out.classList.add('placeholder'); return; }
      const u=uid();
      const qs=new URLSearchParams({ref:kw,utm_content:u}).toString();
      const url=BASE+(BASE.includes('?')?'&':'?')+qs;
      out.innerHTML=`<a href="${url}" target="_blank" rel="noopener">${url}</a>`;
      out.classList.remove('placeholder');
    }
    async function copy(){
      const a=out.querySelector('a'); const url=a?a.href:(out.textContent||'').trim();
      if(!/^https?:\/\//.test(url)){ out.textContent='먼저 링크를 생성하세요'; out.classList.add('placeholder'); return; }
      try{ await navigator.clipboard.writeText(url); btnCopy.textContent='복사 완료 ✅'; setTimeout(()=>btnCopy.textContent='복사 📋',1200);}
      catch{
        const t=document.createElement('textarea'); t.value=url; document.body.appendChild(t); t.select(); document.execCommand('copy'); t.remove();
        btnCopy.textContent='복사 완료 ✅'; setTimeout(()=>btnCopy.textContent='복사 📋',1200);
      }
    }
    btnMake.addEventListener('click', build);
    btnCopy.addEventListener('click', copy);
    key.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ e.preventDefault(); build(); }});
  })();

  // 도구 패널 토글
  (function(){
    const toggle=$('#toolsToggle'), panel=$('#toolsPanel');
    let open=false;
    const setOpen=(v)=>{
      open=v;
      toggle.classList.toggle('open',open);
      panel.classList.toggle('open',open);
      toggle.querySelector('.chev').textContent = open ? '▴' : '▾';
    };
    toggle.addEventListener('click', ()=>setOpen(!open));
    setOpen(false);
  })();

  // 초기화
  (function init(){
    const cats=loadCategories(); categories=cats; catNames=Object.keys(categories);
    if(catNames.length){ renderTabs(); } else { $('#tabs').innerHTML=''; $('#helpers').innerHTML='<div class="placeholder">주제 풀이 없습니다</div>'; }
    enableExports(false);
  })();
</script>
</body>
</html>

