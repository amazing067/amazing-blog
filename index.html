<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>어메이징사업부 블로그 자동화</title>
  <style>
    :root{ --bg1:#f8fbff; --bg2:#fff7fd; --ink:#111827; --ring:#9b87f5; --accent:#7c3aed; --accent2:#9b87f5; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--ink);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(900px 600px at 12% -8%, var(--bg2), transparent 60%),
        radial-gradient(900px 600px at 108% 8%, #eaf2ff, transparent 55%),
        linear-gradient(180deg, var(--bg1), #fff);
      display:grid;place-items:center;padding:28px;
    }
    .wrap{width:100%;max-width:760px}
    .hero{ text-align:center; margin-bottom:14px; }
    .sticker{
      width:74px;height:74px;margin:0 auto 10px; border-radius:18px;display:grid;place-items:center;overflow:hidden;
      background:linear-gradient(135deg,#fef3c7,#fde68a);border:1px solid #fcd34d;
      box-shadow:inset 0 0 0 3px #ffffffb8,0 10px 26px #f59e0b33;
    }
    .title{
      font-size:28px; font-weight:900; margin:0;
      background:linear-gradient(90deg,#7c3aed,#22d3ee,#7c3aed);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      background-size:200% 100%; animation:shine 4s linear infinite;
      letter-spacing:-0.3px;
    }
    @keyframes shine{0%{background-position:0% 50%}100%{background-position:200% 50%}}
    .card{
      background:#ffffffcc;border:1px solid #eef2ff;border-radius:22px;backdrop-filter:blur(8px);
      box-shadow:0 12px 34px #00000012;padding:20px 18px 16px;
    }
    .ask{
      display:flex;align-items:center;gap:8px;background:#fff;border:1.5px solid #e5e7eb;
      border-radius:999px;padding:10px 10px 10px 14px; box-shadow:0 2px 8px #00000008;
      transition:box-shadow .2s,border .2s;
    }
    .ask input{
      flex:1;border:0;outline:none;font-size:15px;background:transparent;
      padding:6px 2px; min-height:22px;
    }
    .send{
      border:0;cursor:pointer; padding:10px 14px;border-radius:999px;color:#fff;
      background:linear-gradient(135deg,var(--accent2),var(--accent));
      box-shadow:0 8px 18px #7c3aed33, inset 0 -6px 12px #00000014;
      display:inline-flex;align-items:center;gap:8px;font-weight:700;
      transition:transform .06s, filter .15s;
    }
    .send:hover{filter:brightness(1.04)}
    .send:active{transform:translateY(1px)}
    .send[disabled]{opacity:.65;cursor:not-allowed}
    .spin{width:16px;height:16px;border-radius:50%;border:2px solid #ffffff80;border-top-color:#fff;display:inline-block;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .helpers{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;justify-content:center}
    .helper{ font-size:12px;border:1px dashed #e5e7eb;background:#fff;border-radius:999px;padding:6px 10px;cursor:pointer; }
    .res{
      margin-top:14px;background:#fff;border:1px solid #eef2ff;border-radius:16px;padding:14px;min-height:130px;
      white-space:pre-wrap;line-height:1.6
    }
    .placeholder{color:#9ca3af;font-size:14px}
    .status{
      display:flex;align-items:center;gap:10px;font-weight:800;
      background:linear-gradient(90deg,#7c3aed,#22d3ee,#7c3aed);
      -webkit-background-clip:text;background-clip:text;color:transparent;
      background-size:200% 100%;animation:shine 3s linear infinite;
    }
    .test-indicator{position:fixed;top:10px;right:10px;background:#ff6b35;color:#fff;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:bold;z-index:1000;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="sticker" aria-hidden="true">
        <svg viewBox="0 0 80 80" width="58" height="58">
          <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#fef3c7"/><stop offset="1" stop-color="#fde68a"/></linearGradient></defs>
          <circle cx="40" cy="40" r="28" fill="url(#g)" stroke="#fbbf24" stroke-width="2"/>
          <circle cx="32" cy="35" r="4" fill="#1f2937"/><circle cx="48" cy="35" r="4" fill="#1f2937"/>
          <path d="M28 49 Q40 58 52 49" stroke="#1f2937" stroke-width="3" fill="none" stroke-linecap="round"/>
          <path d="M18 26 26 18 M54 18 62 26" stroke="#f59e0b" stroke-width="3" stroke-linecap="round"/>
        </svg>
      </div>
      <h1 class="title">어메이징사업부 블로그 자동화</h1>
    </div>

    <!-- ▼▼▼ 초간단 카카오톡 채널 링크 생성기 (이미지/제목 아래) ▼▼▼ -->
    <div class="card" id="chat-link-maker">
      <label style="display:block;font-size:14px;font-weight:800;margin-bottom:10px">
        카카오톡 블로그 채널링크 🔗
      </label>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="k-key" type="text" placeholder=""
               style="flex:1;padding:12px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;outline:none"/>
        <button id="k-make" class="send" type="button">생성 ✨</button>
      </div>

      <div style="display:flex;align-items:center;gap:8px;margin-top:10px">
        <div id="k-result" class="placeholder" style="flex:1;word-break:break-all">
          결과 링크가 여기에 표시됩니다
        </div>
        <button id="k-copy" class="send" type="button" style="white-space:nowrap">복사 📋</button>
      </div>
    </div>
    <!-- ▲▲▲ 추가 끝 ▲▲▲ -->

    <div class="card">
      <div class="ask">
        <input id="q" autocomplete="off" placeholder="주제를 입력하세요" />
        <button id="send" class="send" type="button"><span id="sendLabel">Send</span> 🚀</button>
      </div>

      <div class="helpers" id="helpers">
        <button class="helper" data-text="실손보험 청구 서류 요약해줘">실손 서류 요약</button>
        <button class="helper" data-text="항암 중입자 치료 보장 핵심만 알려줘">중입자치료 핵심</button>
        <button class="helper" data-text="장기요양보험 등급별 차이를 표로 정리해줘">장기요양 표정리</button>
        <button class="helper" data-text="암 주요치료비 보장 항목을 간단히 정리해줘">암 주요치료비 핵심</button>
        <button class="helper" data-text="뇌혈관·심장질환 진단비 차이를 한 문단으로 설명해줘">뇌심 진단비 비교</button>
        <button class="helper" data-text="유병자 보험 3.N.5 구조를 초보자용으로 설명해줘">3.N.5 설명</button>
        <button class="helper" data-text="상급병실 특약이 실제 보장에 어떤 영향을 주는지 알려줘">상급병실 특약</button>
        <button class="helper" data-text="간병인 보험 주요 조건과 주의할 점만 모아줘">간병인 보험 포인트</button>
      </div>

      <div id="res" class="res"></div>
    </div>
  </div>

<script>
  // 테스트 모드 확인
  function isTestMode() {
    return window.location.search.includes('test=true') || window.location.search.includes('debug=true');
  }
  // 어디로 보낼지: hooks 도메인(고정) + 워크플로우 경로만 바꾸면 됨
  const HOOKS_BASE = 'https://hooks.xn--h32b21du9cf7grcy2k20f.com';
  const WF_PATH = 'ask'; // ← 여기만 다른 워크플로우의 Webhook Path로 바꿔도 OK (예: 'blog-writer')
  const WEBHOOK_URL = isTestMode()
    ? `${HOOKS_BASE}/webhook-test/${WF_PATH}`   // 에디터 Test 모드 (실시간 캡처)
    : `${HOOKS_BASE}/webhook/${WF_PATH}`;       // 운영 모드

  if (isTestMode()) {
    const indicator = document.createElement('div');
    indicator.className = 'test-indicator';
    indicator.textContent = 'TEST MODE';
    document.body.appendChild(indicator);
    console.log('🔧 테스트 모드 활성화 - n8n Editor에서 실시간 확인 가능');
    console.log('📡 사용 중인 웹훅 URL:', WEBHOOK_URL);
  }

  const $ = (s)=>document.querySelector(s);
  const q = $('#q'), btn = $('#send'), res = $('#res'), sendLabel = $('#sendLabel');
  res.innerHTML = '<div class="placeholder">결과는 여기에 표시됩니다</div>';

  function loading(on){
    if(on){
      btn.disabled = true;
      sendLabel.innerHTML = '<span class="spin"></span>';
      res.innerHTML = '<div class="status"><span class="spin"></span>💡 AI가 열심히 작업 중입니다…</div>';
    } else {
      btn.disabled = false;
      sendLabel.textContent = 'Send';
    }
  }

  async function postJson(url, body){
    const r = await fetch(url,{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body) });
    const text = await r.text();
    let data; try{ data = JSON.parse(text); } catch { data = { raw:text }; }
    return { ok:r.ok, status:r.status, data };
  }

  // ---- HTML 감지/복원/렌더 ----
  function looksLikeHtml(s){
    return /^\s*<(?:!DOCTYPE|html|body|main|div|section|article|h1|h2|p|iframe)\b/i.test(s || "");
  }
  function decodeHtmlEntities(str) {
    if (typeof str !== 'string') return str;
    const el = document.createElement("textarea");
    el.innerHTML = str;
    return el.value;
  }
  function extractEmbeddable(htmlString){
    try {
      const s = String(htmlString || "");
      const m = s.match(/^\s*<iframe\b[^>]*\bsrcdoc=(["'])([\s\S]*?)\1[^>]*>\s*<\/iframe>\s*$/i);
      if (m) {
        const ta = document.createElement("textarea");
        ta.innerHTML = m[2];
        return ta.value;
      }
      if (/^\s*<iframe\b/i.test(s)) return s;
      const parser = new DOMParser();
      const doc = parser.parseFromString(s, "text/html");
      const main = doc.querySelector("main");
      if (main) return main.innerHTML;
      if (doc.body) return doc.body.innerHTML || s;
      return s;
    } catch {
      return htmlString;
    }
  }
  function pickHtmlPayload(data, fallback){
    const candidates = [
      data?.html_document, data?.html, data?.content, data?.body,
      data?.answer?.html_document, data?.answer?.html,
      data?.data?.html_document, data?.data?.html,
      data?.json?.html_document, data?.json?.html, fallback
    ].filter(v => typeof v === 'string');

    for (let raw of candidates){
      const dec = /&lt;|&gt;|&amp;|&quot;|&#39;/.test(raw) ? decodeHtmlEntities(raw) : raw;
      if (looksLikeHtml(dec)) return dec;
    }
    return null;
  }
  function renderHtmlIntoResult(html){
    const cleaned = decodeHtmlEntities(html);
    const embeddable = extractEmbeddable(cleaned);
    res.innerHTML = embeddable;
    res.style.whiteSpace = 'normal';
    res.style.textAlign = 'left';
    res.style.display = 'block';
    res.style.minHeight = 'auto';
  }

  async function send(){
    const topic = q.value.trim();
    if(topic.length < 2){ q.focus(); res.textContent='Please enter at least 2 characters.'; return; }
    loading(true);
    try{
      const r = await postJson(WEBHOOK_URL, { topic });
      if(!r.ok){ res.textContent = `HTTP ${r.status}\n` + JSON.stringify(r.data,null,2); return; }
      const ans = r.data?.answer ?? r.data?.data ?? r.data?.raw ?? r.data ?? { ok:true };
      const html = pickHtmlPayload(r.data, typeof ans==='string' ? ans : '');
      if (html){ renderHtmlIntoResult(html); return; }
      res.textContent = (typeof ans==='string') ? ans : JSON.stringify(ans,null,2);
    }catch(e){
      res.textContent = 'Network error: ' + (e?.message || String(e));
    }finally{ loading(false); }
  }
  btn.addEventListener('click', send);
  q.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); send(); }});

  /* ---- Simple Kakao Chat Link Generator (PROD redirect base) ---- */
  (function(){
    const BASE = 'https://hooks.xn--h32b21du9cf7grcy2k20f.com/webhook/kakao-redirect';
    const key = document.getElementById('k-key');
    const btnMake = document.getElementById('k-make');
    const btnCopy = document.getElementById('k-copy');
    const out = document.getElementById('k-result');

    function uid(){
      return Date.now().toString(36) + Math.random().toString(36).slice(2,10);
    }

    function build(){
      const kw = (key.value || '').trim();
      if(!kw){
        out.textContent = '키워드를 입력하세요';
        out.classList.add('placeholder');
        return;
      }
      // 매 호출마다 고유 utm_content 부여 → 링크 절대 중복 방지
      const u = uid();
      const qs = new URLSearchParams({ ref: kw, utm_content: u }).toString();
      const url = BASE + (BASE.includes('?') ? '&' : '?') + qs;
      out.innerHTML = `<a href="${url}" target="_blank" rel="noopener">${url}</a>`;
      out.classList.remove('placeholder');
    }

    async function copy(){
      const a = out.querySelector('a');
      const url = a ? a.href : (out.textContent || '').trim();
      if(!/^https?:\/\//.test(url)){
        out.textContent = '먼저 링크를 생성하세요';
        out.classList.add('placeholder');
        return;
      }
      try{
        await navigator.clipboard.writeText(url);
        btnCopy.textContent = '복사 완료 ✅';
        setTimeout(()=>{ btnCopy.textContent = '복사 📋'; }, 1200);
      }catch{
        const t = document.createElement('textarea');
        t.value = url; document.body.appendChild(t); t.select(); document.execCommand('copy'); document.body.removeChild(t);
        btnCopy.textContent = '복사 완료 ✅';
        setTimeout(()=>{ btnCopy.textContent = '복사 📋'; }, 1200);
      }
    }

    btnMake.addEventListener('click', build);
    btnCopy.addEventListener('click', copy);
    key.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); build(); }});
  })();
</script>
</body>
</html>
