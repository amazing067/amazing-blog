<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ì–´ë©”ì´ì§•ì‚¬ì—…ë¶€ ë¸”ë¡œê·¸ ìë™í™”</title>
  <style>
    :root{
      --bg1:#f8fbff; --bg2:#fff7fd; --ink:#111827; --ring:#9b87f5;
      --accent:#7c3aed; --accent2:#9b87f5;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--ink);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(900px 600px at 12% -8%, var(--bg2), transparent 60%),
        radial-gradient(900px 600px at 108% 8%, #eaf2ff, transparent 55%),
        linear-gradient(180deg, var(--bg1), #fff);
      display:grid;place-items:center;padding:28px;
    }
    .wrap{width:100%;max-width:760px}
    .hero{ text-align:center; margin-bottom:14px; }
    .sticker{
      width:74px;height:74px;margin:0 auto 10px; border-radius:18px;display:grid;place-items:center;overflow:hidden;
      background:linear-gradient(135deg,#fef3c7,#fde68a);border:1px solid #fcd34d;
      box-shadow:inset 0 0 0 3px #ffffffb8,0 10px 26px #f59e0b33;
    }
    .title{
      font-size:28px; font-weight:900; margin:0;
      background:linear-gradient(90deg,#7c3aed,#22d3ee,#7c3aed);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      background-size:200% 100%; animation:shine 4s linear infinite;
      letter-spacing:-0.3px;
    }
    @keyframes shine{0%{background-position:0% 50%}100%{background-position:200% 50%}}
    .card{
      background:#ffffffcc;border:1px solid #eef2ff;border-radius:22px;backdrop-filter:blur(8px);
      box-shadow:0 12px 34px #00000012;padding:20px 18px 16px;
    }
    .ask{
      display:flex;align-items:center;gap:8px;background:#fff;border:1.5px solid #e5e7eb;
      border-radius:999px;padding:10px 10px 10px 14px; box-shadow:0 2px 8px #00000008;
      transition:box-shadow .2s,border .2s;
    }
    .ask input{
      flex:1;border:0;outline:none;font-size:15px;background:transparent;
      padding:6px 2px; min-height:22px;
    }
    .send{
      border:0;cursor:pointer; padding:10px 14px;border-radius:999px;color:#fff;
      background:linear-gradient(135deg,var(--accent2),var(--accent));
      box-shadow:0 8px 18px #7c3aed33, inset 0 -6px 12px #00000014;
      display:inline-flex;align-items:center;gap:8px;font-weight:700;
      transition:transform .06s, filter .15s;
    }
    .send:hover{filter:brightness(1.04)}
    .send:active{transform:translateY(1px)}
    .send[disabled]{opacity:.65;cursor:not-allowed}
    .spin{width:16px;height:16px;border-radius:50%;border:2px solid #ffffff80;border-top-color:#fff;display:inline-block;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .helpers{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;justify-content:center}
    .helper{ font-size:12px;border:1px dashed #e5e7eb;background:#fff;border-radius:999px;padding:6px 10px;cursor:pointer; }

    .res{
      margin-top:14px;background:#fff;border:1px solid #eef2ff;border-radius:16px;padding:14px;min-height:130px;
      white-space:pre-wrap;line-height:1.6
    }
    .placeholder{color:#9ca3af;font-size:14px}
    .status{
      display:flex;align-items:center;gap:10px;font-weight:800;
      background:linear-gradient(90deg,#7c3aed,#22d3ee,#7c3aed);
      -webkit-background-clip:text;background-clip:text;color:transparent;
      background-size:200% 100%;animation:shine 3s linear infinite;
    }
    .test-indicator{position:fixed;top:10px;right:10px;background:#ff6b35;color:#fff;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:bold;z-index:1000;}
    .res.editing{ outline:2px dashed #9b87f5; box-shadow: inset 0 0 0 3px #f3f0ff; }

    /* helpers / exporters ë¶„ë¦¬ì„  & ì»¬ëŸ¬ ë²„íŠ¼ 3ì¢… */
    #exporters{
      border-top:1px dashed #e5e7eb;
      margin-top:12px; padding-top:12px; position:relative;
    }
    #exporters::before{
      content:""; position:absolute;left:0;right:0;top:-1px;height:1px;
      background:linear-gradient(90deg,#ffffff00,#e5e7eb,#ffffff00);
    }
    .chip{
      border:0; cursor:pointer; padding:8px 12px; border-radius:999px;
      color:#fff; font-weight:700; display:inline-flex; align-items:center; gap:6px;
      box-shadow:0 8px 18px #00000014, inset 0 -6px 12px #0000000f;
      transition:transform .06s, filter .15s;
    }
    .chip:hover{ filter:brightness(1.06); }
    .chip:active{ transform:translateY(1px); }
    .chip:disabled{ opacity:.55; cursor:not-allowed; }
    .chip-edit{ background:linear-gradient(135deg,#8b5cf6,#6d28d9); }
    .chip-html{ background:linear-gradient(135deg,#14b8a6,#0ea5e9); }
    .chip-pdf { background:linear-gradient(135deg,#f43f5e,#fb7185); }

    /* ì¹´í…Œê³ ë¦¬ ë¼ë²¨ + íƒ­ (ê°€ìš´ë° ì •ë ¬) */
    #catHeader{ display:flex; align-items:center; justify-content:center; gap:8px; margin-top:12px; }
    #catBadge{
      font-size:11px; font-weight:900; letter-spacing:.6px;
      padding:4px 8px; border-radius:999px; color:#4c1d95; background:#ede9fe; border:1px solid #ddd6fe;
    }
    #tabs{ margin-top:6px; gap:6px; justify-content:center; }
    .tab{
      border:1px solid #e5e7eb; background:#fff; color:#374151;
      padding:8px 12px; border-radius:999px; font-size:12px; cursor:pointer;
      transition:background .15s, color .15s, border .15s;
    }
    .tab:hover{ background:#fafafa; }
    .tab.active{
      color:#fff; border:1px solid transparent;
      background:linear-gradient(135deg,#7c3aed,#22d3ee);
      box-shadow:0 8px 18px #7c3aed33, inset 0 -6px 12px #00000014;
    }

    /* ì„œì‹ íˆ´ë°” */
    #toolbar{
      margin-top:12px; padding:10px; border:1px dashed #e5e7eb; border-radius:12px;
      background:linear-gradient(180deg,#ffffff,#fafbff);
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center;
    }
    .tool{
      border:0; cursor:pointer; border-radius:10px; padding:8px 10px; font-size:12px; font-weight:700;
      color:#fff; display:inline-flex; align-items:center; gap:6px;
      box-shadow:0 6px 14px #00000010, inset 0 -6px 12px #0000000f;
      transition:transform .06s, filter .15s;
    }
    .tool:hover{ filter:brightness(1.06); }
    .tool:active{ transform:translateY(1px); }
    .tool[disabled]{ opacity:.55; cursor:not-allowed; }
    .t-bold{ background:linear-gradient(135deg,#111827,#4b5563); }
    .t-italic{ background:linear-gradient(135deg,#6b7280,#9ca3af); }
    .t-underline{ background:linear-gradient(135deg,#0ea5e9,#38bdf8); }
    .t-h2{ background:linear-gradient(135deg,#16a34a,#22c55e); }
    .t-h3{ background:linear-gradient(135deg,#10b981,#34d399); }
    .t-ul{ background:linear-gradient(135deg,#fb923c,#f59e0b); }
    .t-ol{ background:linear-gradient(135deg,#f97316,#ea580c); }
    .t-left{ background:linear-gradient(135deg,#818cf8,#6366f1); }
    .t-center{ background:linear-gradient(135deg,#a78bfa,#8b5cf6); }
    .t-right{ background:linear-gradient(135deg,#c4b5fd,#a78bfa); }
    .t-link{ background:linear-gradient(135deg,#6366f1,#8b5cf6); }
    .t-color{ background:linear-gradient(135deg,#ef4444,#eab308,#22c55e,#3b82f6,#8b5cf6); color:#111827; font-weight:800; }
    .tool-lite{
      border:1px dashed #e5e7eb; background:#fff; color:#374151; box-shadow:none;
    }
    .color-picker{ appearance:none; width:28px; height:28px; border-radius:8px; border:1px solid #e5e7eb; padding:0; }
    .color-picker::-webkit-color-swatch{ border:none; border-radius:8px; }

    /* ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ & ë– ìˆëŠ” íŒ¨ë„ */
    .img-selected{ outline:2px solid #7c3aed; outline-offset:2px; }
    .img-handle{
      position:absolute; width:12px; height:12px; border-radius:50%;
      background:#7c3aed; box-shadow:0 2px 6px #00000033; cursor:nwse-resize;
      right:-6px; bottom:-6px; z-index:2;
    }
    .img-fab{
      position:absolute; transform:translate(-50%,-100%); left:50%; top:0;
      background:#111827; color:#fff; padding:8px 10px; border-radius:12px;
      box-shadow:0 10px 24px #00000033; display:flex; align-items:center; gap:8px; z-index:2;
    }
    .img-fab input[type="range"]{ width:120px; }
    .img-fab button{ border:0; border-radius:999px; padding:6px 8px; cursor:pointer; font-weight:800; }
    .img-fab .p50{ background:#fde68a; }
    .img-fab .p75{ background:#a7f3d0; }
    .img-fab .p100{ background:#bfdbfe; }

    /* ìŠ¤ëƒ…ìƒ· ë°•ìŠ¤ */
    #snapBox{
      margin-top:8px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center; align-items:center;
    }
    #snapBox select{ padding:8px 10px; border-radius:10px; border:1px solid #e5e7eb; background:#fff; }
    #snapBox .btn{ padding:8px 12px; border-radius:999px; border:0; color:#fff; font-weight:700; cursor:pointer; }
    #btnSnapSave{ background:linear-gradient(135deg,#0ea5e9,#6366f1); }
    #btnSnapLoad{ background:linear-gradient(135deg,#22c55e,#16a34a); }
    #btnSnapDel{  background:linear-gradient(135deg,#ef4444,#f97316); }

    /* ë³¸ë¬¸ ì „ì²´ ê¸€ì í¬ê¸° ì»¨íŠ¸ë¡¤ */
    #fontBox{ margin-top:8px; display:flex; justify-content:center; align-items:center; gap:8px; }
    #fontBox .btn{ padding:6px 10px; border-radius:8px; border:1px dashed #e5e7eb; background:#fff; cursor:pointer; }
    #fontBox .val{ font-weight:800; color:#334155; min-width:50px; text-align:center; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="sticker" aria-hidden="true">
        <svg viewBox="0 0 80 80" width="58" height="58">
          <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#fef3c7"/><stop offset="1" stop-color="#fde68a"/></linearGradient></defs>
          <circle cx="40" cy="40" r="28" fill="url(#g)" stroke="#fbbf24" stroke-width="2"/>
          <circle cx="32" cy="35" r="4" fill="#1f2937"/><circle cx="48" cy="35" r="4" fill="#1f2937"/>
          <path d="M28 49 Q40 58 52 49" stroke="#1f2937" stroke-width="3" fill="none" stroke-linecap="round"/>
          <path d="M18 26 26 18 M54 18 62 26" stroke="#f59e0b" stroke-width="3" stroke-linecap="round"/>
        </svg>
      </div>
      <h1 class="title">ì–´ë©”ì´ì§•ì‚¬ì—…ë¶€ ë¸”ë¡œê·¸ ìë™í™”</h1>
    </div>

    <!-- ì¹´ì¹´ì˜¤ ë§í¬ ìƒì„±ê¸° (ì›ë³¸ ìœ ì§€) -->
    <div class="card" id="chat-link-maker">
      <label style="display:block;font-size:14px;font-weight:800;margin-bottom:10px">ì¹´ì¹´ì˜¤í†¡ ë¸”ë¡œê·¸ ì±„ë„ë§í¬ ğŸ”—</label>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="k-key" type="text" placeholder=""
               style="flex:1;padding:12px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;outline:none"/>
        <button id="k-make" class="send" type="button">ìƒì„± âœ¨</button>
      </div>
      <div style="display:flex;align-items:center;gap:8px;margin-top:10px">
        <div id="k-result" class="placeholder" style="flex:1;word-break:break-all">ê²°ê³¼ ë§í¬ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
        <button id="k-copy" class="send" type="button" style="white-space:nowrap">ë³µì‚¬ ğŸ“‹</button>
      </div>
    </div>

    <div class="card">
      <div class="ask">
        <input id="q" autocomplete="off" placeholder="ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
        <button id="send" class="send" type="button"><span id="sendLabel">Send</span> ğŸš€</button>
      </div>

      <!-- ì¹´í…Œê³ ë¦¬ ë¼ë²¨ + íƒ­ -->
      <div id="catHeader"><span id="catBadge">ì¹´í…Œê³ ë¦¬</span></div>
      <div class="helpers" id="tabs"></div>

      <!-- helpers (3ê°œ ë¡œí…Œì´ì…˜) -->
      <div class="helpers" id="helpers"></div>

      <!-- ë¶„ë¦¬ì„  + ì»¬ëŸ¬ ë²„íŠ¼ 3ì¢… -->
      <div class="helpers" id="exporters">
        <button class="chip chip-edit" id="toggleEdit" data-on="ìˆ˜ì • ì¢…ë£Œ" data-off="ìˆ˜ì • ëª¨ë“œ">ìˆ˜ì • ëª¨ë“œ</button>
        <button class="chip chip-html" id="downloadHtml" disabled>HTML ì €ì¥</button>
        <button class="chip chip-pdf"  id="downloadPdf"  disabled>PDF ì €ì¥</button>
      </div>

      <!-- ì„œì‹ íˆ´ë°” -->
      <div id="toolbar" class="helpers">
        <button class="tool t-bold"      data-cmd="bold">êµµê²Œ</button>
        <button class="tool t-italic"    data-cmd="italic">ê¸°ìš¸ì„</button>
        <button class="tool t-underline" data-cmd="underline">ë°‘ì¤„</button>
        <button class="tool t-h2"        data-cmd="formatBlock" data-val="H2">H2</button>
        <button class="tool t-h3"        data-cmd="formatBlock" data-val="H3">H3</button>
        <button class="tool t-ul"        data-cmd="insertUnorderedList">ëª©ë¡</button>
        <button class="tool t-ol"        data-cmd="insertOrderedList">ë²ˆí˜¸</button>
        <button class="tool t-left"      data-cmd="justifyLeft">ì™¼ìª½</button>
        <button class="tool t-center"    data-cmd="justifyCenter">ê°€ìš´ë°</button>
        <button class="tool t-right"     data-cmd="justifyRight">ì˜¤ë¥¸ìª½</button>
        <button class="tool t-link"      id="mkLink">ë§í¬</button>
        <label class="tool t-color" style="gap:8px;">
          ìƒ‰ìƒ <input type="color" id="foreColor" class="color-picker" value="#333333" title="í…ìŠ¤íŠ¸ ìƒ‰ìƒ"/>
        </label>
      </div>

      <!-- ìŠ¤ëƒ…ìƒ· + ì „ì²´ ê¸€ì”¨í¬ê¸° -->
      <div id="snapBox" class="helpers">
        <button class="btn" id="btnSnapSave">ìŠ¤ëƒ…ìƒ· ì €ì¥</button>
        <select id="snapSelect" title="ì €ì¥ëœ ìŠ¤ëƒ…ìƒ·"></select>
        <button class="btn" id="btnSnapLoad">ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button class="btn" id="btnSnapDel">ì‚­ì œ</button>
      </div>
      <div id="fontBox" class="helpers">
        <button class="btn" id="fontDown">A-</button>
        <span class="val" id="fontVal">100%</span>
        <button class="btn" id="fontUp">A+</button>
        <span class="placeholder">/ ì„ íƒ ê¸€ìí¬ê¸°: </span>
        <input type="range" id="selFont" min="70" max="200" value="100" style="width:140px" title="ì„ íƒ ì˜ì—­ ê¸€ì í¬ê¸°"/>
      </div>

      <div id="res" class="res"><div class="placeholder">ê²°ê³¼ëŠ” ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div></div>
    </div>
  </div>

  <!-- ì¹´í…Œê³ ë¦¬ë³„ ì£¼ì œ 30ê°œì”© (ìƒ˜í”Œ) -->
  <script type="application/json" id="topic-categories">{
    "ì‹¤ì†ë³´í—˜": [
      "ì‹¤ì†ë³´í—˜ ì²­êµ¬ì„œë¥˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ 2025","ì‹¤ì†ë³´í—˜ ì²­êµ¬ ë°©ë²• ì•±Â·ë³‘ì›ì„œë¥˜ ì •ë¦¬","ì‹¤ì†ë³´í—˜ í†µì›ë¹„ ì˜ìˆ˜ì¦ ëˆ„ë½ ëŒ€ì²˜",
      "ë¹„ê¸‰ì—¬ ì£¼ì‚¬ ì‹¤ì† ì²­êµ¬ ê¸°ì¤€","ë„ìˆ˜ì¹˜ë£ŒÂ·ì²´ì™¸ì¶©ê²©íŒŒ ì²­êµ¬ ê°€ëŠ¥ ë²”ìœ„","MRIÂ·MRA ì‹¤ì† ì²­êµ¬ ë˜ëŠ”ì§€",
      "ì´ˆìŒíŒŒÂ·ë‚´ì‹œê²½ ì‹¤ì† ì¸ì • ê¸°ì¤€","ì¹˜ê³¼ ìŠ¤ì¼€ì¼ë§ ì‹¤ì† ì ìš©ë˜ëŠ”ê°€","í•œì˜ì› ì¹˜ë£Œ ì‹¤ì† ì²­êµ¬ í¬ì¸íŠ¸",
      "ì•½ì œë¹„ ì‹¤ì† ì²­êµ¬ ë°©ë²•","ì „ìì˜ìˆ˜ì¦Â·ì²˜ë°©ì „ ë¶„ì‹¤ ì‹œ ë°©ë²•","ì‹¤ì† ê³µì œê¸ˆì•¡Â·ìê¸°ë¶€ë‹´ ê³„ì‚°",
      "ì‹¤ì† í•©ì‚°í•œë„ì™€ ì¤‘ë³µê°€ì… ì£¼ì˜","ìŠ¤ë§ˆíŠ¸ì²­êµ¬ ì•± ì‚¬ìš©ë²• ë¹„êµ","ì‹¤ì† ì²­êµ¬ê¸°í•œê³¼ ì‹¬ì‚¬ê¸°ê°„",
      "ë¶€ì§€ê¸‰ ë¹ˆë²ˆí•œ ì‚¬ìœ  ì •ë¦¬","ì…ì›ì˜ë£Œë¹„Â·í†µì›ì˜ë£Œë¹„ ì°¨ì´","ì˜ë¬´ê¸°ë¡ì‚¬ë³¸Â·ì§„ë‹¨ì„œ ë°œê¸‰ ê¿€íŒ",
      "ë¹„ê¸‰ì—¬ ì£¼ì‚¬ ì¢…ë¥˜ë³„ ì½”ë“œ ì •ë¦¬","ì¬ê°€ì…/ì „í™˜ ì‹œ ìœ ì˜ì‚¬í•­","í‘œì¤€í™” ì‹¤ì† vs ì‹ ì‹¤ì† ì°¨ì´",
      "ê°±ì‹  ì£¼ê¸°ì™€ ë³´í—˜ë£Œ ì¸ìƒ í¬ì¸íŠ¸","íŠ¹ì•½ êµ¬ì„± ìµœì†ŒÂ·ê¶Œì¥ ê°€ì´ë“œ","ì¹˜ë£Œ í›„ ì˜ìˆ˜ì¦ ë¶„ì‹¤ í•´ê²°",
      "ì§ˆë³‘/ìƒí•´ êµ¬ë¶„ ì²´í¬ë¦¬ìŠ¤íŠ¸","ì¹˜ë£Œë¹„ ì„ ê²°ì œ í›„ ì²­êµ¬ ì ˆì°¨","ì‹¤ì† ë³´ìƒë¹„ìœ¨ ê³„ì‚° ì˜ˆì‹œ",
      "ê°„ë³‘ë¹„Â·ë„ìš°ë¯¸ ë¹„ìš© ì²­êµ¬ ê°€ëŠ¥?","í•´ì™¸ ì§„ë£Œ ì‹¤ì† ì²­êµ¬ ë˜ëŠ”ì§€","ì´ì¤‘ ì²­êµ¬ ë°©ì§€ ì²´í¬í¬ì¸íŠ¸"
    ],
    "ì•”ë³´í—˜": [
      "ì•”ë³´í—˜ ì§„ë‹¨ë¹„ ì§€ê¸‰ì¡°ê±´ í•µì‹¬","ìœ ì‚¬ì•” ë³´ì¥ ë²”ìœ„ì™€ ì˜ˆì™¸","ê°‘ìƒì„ ì•” ì†Œì•¡ì•” ê¸°ì¤€ ì—…ë°ì´íŠ¸",
      "ê¸°íƒ€í”¼ë¶€ì•” ì½”ë“œì™€ ì²­êµ¬ í¬ì¸íŠ¸","í‘œì í•­ì•”Â·ë©´ì—­í•­ì•” ë³´ì¥ êµ¬ì¡°","í•­ì•” ë°©ì‚¬ì„ Â·ìˆ˜ìˆ  ë³‘í–‰ ë³´ì¥",
      "ì•” ì‚°ì •íŠ¹ë¡€ ì‹ ì²­ ë°©ë²•","ì•” ì…ì›ì¼ë‹¹Â·ìˆ˜ìˆ ë¹„ êµ¬ì„±ë²•","ì¬ì§„ë‹¨ì•” ë³´ì¥ ì¡°ê±´ ë¹„êµ",
      "í•­ì•” ë¶€ì‘ìš© ë³´ì¥(ì˜¤ì‹¬Â·íƒˆëª¨ ë“±)","ì•”ë³´í—˜ ê°±ì‹ í˜• vs ë¹„ê°±ì‹ í˜•","ë¬´í•´ì§€í™˜ê¸‰í˜• ì¥ë‹¨ì ",
      "ì—¬ì„±ì•” íŠ¹ì•½(ìœ ë°©Â·ìê¶) ë¹„êµ","ë‚¨ì„±ì•” íŠ¹ì•½(ì „ë¦½ì„  ë“±) ì²´í¬","ê°€ì¡±ë ¥ ìˆì„ ë•Œ ê°€ì… íŒ",
      "ê°€ì… ì „ ê³ ì§€ì‚¬í•­ ì²´í¬ë¦¬ìŠ¤íŠ¸","ë³´í—˜ê¸ˆ ë¶€ì§€ê¸‰ ìì£¼ ë‚˜ì˜¤ëŠ” ì‚¬ë¡€","ì•”ì§„ë‹¨ ì½”ë“œ C~ êµ¬ë¶„ ì´í•´",
      "í‘œì ì¹˜ë£Œì œ ë³¸ì¸ë¶€ë‹´ ë¹„ìš© ì‚¬ë¡€","ë©´ì—­í•­ì•” ê¸‰ì—¬/ë¹„ê¸‰ì—¬ ì°¨ì´","ì•” ì¹˜ë£Œë¹„ ì ˆê° íŒ ëª¨ìŒ",
      "ë³´í—˜ë£Œ ì¸ìƒ ìš”ì¸ê³¼ ê´€ë¦¬ë²•","ë‹¤ë¥¸ íŠ¹ì•½ê³¼ ì¤‘ë³µ ë³´ì¥ ì‚¬ë¡€","ì¹˜ë£Œ í›„ ì¶”ê°€ê²€ì‚¬ ë¹„ìš© ë³´ì¥",
      "ìœ ì‚¬ì•”ì—ì„œ ì¼ë°˜ì•” ì „í™˜ ì‚¬ë¡€","ì¹˜ë£Œ ì¤‘ ì´ì‚¬/ë³‘ì› ë³€ê²½ ì²­êµ¬","ì•” ì™„ì¹˜ í›„ ë³´í—˜ ì¬ê°€ì…",
      "ì–´ë¦°ì´ ì•”ë³´í—˜ ê³ ë ¤ í¬ì¸íŠ¸","ê³ ë ¹ì ì•”ë³´í—˜ ê°€ëŠ¥ ì—¬ë¶€","ì•”ë³´í—˜ ì•½ê´€ ì½ëŠ” ë²•"
    ],
    "ìš´ì „ìë³´í—˜": [
      "ìš´ì „ìë³´í—˜ íŠ¹ì•½ ìµœì†Œ êµ¬ì„± ê°€ì´ë“œ","í˜•ì‚¬í•©ì˜ê¸ˆÂ·ë³€í˜¸ì‚¬ë¹„ìš© ë³´ì¥","êµí†µì‚¬ê³ ì²˜ë¦¬ì§€ì›ê¸ˆ ì§€ê¸‰ì¡°ê±´",
      "ë²Œì Â·ë©´í—ˆì •ì§€Â·ì·¨ì†Œ ê´€ë ¨ ë³´ì¥","ìŒì£¼Â·ë¬´ë©´í—ˆ ì˜ˆì™¸ ì¡°í•­ ì •ë¦¬","ìŠ¤ì¿¨ì¡´ ì‚¬ê³  ë³´ì¥ ë²”ìœ„",
      "ìì „ê±°Â·í‚¥ë³´ë“œ ì‚¬ê³  ë³´ì¥ í™•ì¸","ëŒ€ë¬¼Â·ëŒ€ì¸ê³¼ì˜ ì°¨ì´ ì´í•´","ì´ˆê³¼ì±…ì„ ë³´ì¥ ì²´í¬",
      "ê³¼ì‹¤ë¹„ìœ¨ì— ë”°ë¥¸ ì²˜ë¦¬ íŒ","ëº‘ì†Œë‹ˆ ê°€í•´Â·í”¼í•´ ë³´ì¥ ì°¨ì´","í•©ì˜ ìš”ë ¹ ë° ì„œë¥˜",
      "íŠ¹ì•½ë³„ ê°€ì…ê¸ˆì•¡ ê¶Œì¥ì„ ","ìê¸°ë¶€ë‹´ê¸ˆ êµ¬ì¡° ì´í•´","ê°€ì¡±ìš´ì „ì ë²”ìœ„ ì„¤ì •",
      "ìë™ì°¨ìƒí•´ vs ìë™ì°¨ë³´í—˜ ì°¨ì´","íƒì‹œÂ·ëŒ€ë¦¬ìš´ì „ ì¢…ì‚¬ì íŠ¹ì•½","ìš´ì „ìë³´í—˜ ê°±ì‹ /í•´ì§€ íŒ",
      "ë²Œê¸ˆ ë³´ì¥ í•œë„ì™€ ì œì™¸","ì¤‘ìƒí•´ì²˜ë²Œë²• ê´€ë ¨ ì´ìŠˆ","ëŒ€ë¦¬ê¸°ì‚¬ ì‚¬ê³  ì‹œ ì²˜ë¦¬",
      "ì£¼ì •ì°¨ ì‚¬ê³  ì²˜ë¦¬ ìš”ë ¹","ì°¨ëŒ€ì‚¬ëŒ ì‚¬ê³  í•©ì˜ íŒ","ë ŒíŠ¸ì¹´Â·ì¹´ì…°ì–´ë§ ë³´ì¥ì—¬ë¶€",
      "ë¬´ë‹¨íš¡ë‹¨ ì‚¬ê³  ëŒ€ì‘","ë¸”ë™ë°•ìŠ¤ ì˜ìƒ ë³´ì¡´ ìš”ë ¹","ì‚¬ê³  í›„ ë³‘ì› ì§„ë‹¨ì„œ ì¤€ë¹„",
      "ì´ˆë³´ìš´ì „ ê¼­ ì•Œì•„ë‘˜ íŠ¹ì•½","ì‹ ì°¨ êµ¬ë§¤ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸","ë³´í—˜ë£Œ ì•„ë¼ëŠ” íŒ"
    ],
    "ì¥ê¸°ìš”ì–‘/ê°„ë³‘": [
      "ì¥ê¸°ìš”ì–‘ ë“±ê¸‰ íŒì • ê¸°ì¤€ ì´ì •ë¦¬","ì¥ê¸°ìš”ì–‘ ì¸ì •ì ìˆ˜ ê³„ì‚° ë°©ë²•","ë“±ê¸‰ë³„ ì´ìš© ê°€ëŠ¥ ì„œë¹„ìŠ¤",
      "ë°©ë¬¸ìš”ì–‘Â·ëª©ìš•Â·ê°„í˜¸ ì°¨ì´","ì‹œì„¤ ì…ì†Œ ì ˆì°¨ì™€ ë¹„ìš©","ê°€ì¡±ìš”ì–‘ ì¡°ê±´ê³¼ ì£¼ì˜ì‚¬í•­",
      "ë³¸ì¸ë¶€ë‹´ê¸ˆ ê³„ì‚°ê³¼ ê°ë©´","ê°„ë³‘ì¸ ë¹„ìš© í˜„ì‹¤ê³¼ ë³´ì¥","ê°„ë³‘ì¸ë³´í—˜ í•µì‹¬ íŠ¹ì•½",
      "ìš”ì–‘ë³‘ì› vs ìš”ì–‘ì› ì°¨ì´","ì¹˜ë§¤ ë“±ê¸‰ê³¼ ì§€ì› ì œë„","ì¥ê¸°ìš”ì–‘ ì¬íŒì • ì¤€ë¹„",
      "ëŒë´„ì„œë¹„ìŠ¤ ì§€ì—­ ì§€ì› ì°¾ê¸°","í™˜ìì´ì†¡ ì„œë¹„ìŠ¤ ë¹„ìš©","ì˜ì‚¬ ì†Œê²¬ì„œ ì¤€ë¹„ ìš”ë ¹",
      "ìˆ˜ê¸‰ìÂ·ë³´í˜¸ì ì²´í¬ë¦¬ìŠ¤íŠ¸","ì§€ê¸‰ì •ì§€/ë³€ê²½ ì‚¬ìœ  ì •ë¦¬","ìš”ì–‘ì„œë¹„ìŠ¤ ë¶ˆë§Œ ì²˜ë¦¬",
      "ì¬í™œì¹˜ë£Œ ë³‘í–‰ ì‹œ ë¹„ìš©","ê°„ë³‘ ì†Œëª¨í’ˆ ì§€ì› ì•ˆë‚´","ë“±ê¸‰íƒˆë½ í›„ ëŒ€ì²˜ë²•",
      "ê°€ì •ê°„í˜¸ë³´í—˜ í™œìš©ë²•","ì¥ê¸°ìš”ì–‘ë³´í—˜ë£Œ ì‚°ì •","ìš”ì–‘ ë„ì¤‘ ì´ì‚¬ ëŒ€ì‘",
      "ëŒ€ìƒì ë¶€ì¬ ì‹œ ì²˜ë¦¬","êµ­ë¯¼ê±´ê°•ë³´í—˜ ê³µë‹¨ ì ˆì°¨","ì¥ê¸°ìš”ì–‘ ê³µë‹¨ ì „í™” ê¿€íŒ",
      "ë°©ë¬¸ìš”ì–‘ ê¸°ê´€ ì„ íƒ ê¸°ì¤€","ì•¼ê°„/24ì‹œê°„ ê°„ë³‘ ë¹„ìš©","ê°€ì‚¬Â·ëŒë´„ ë°”ìš°ì²˜ ì•ˆë‚´"
    ],
    "í•´ì™¸ì—¬í–‰ë³´í—˜": [
      "í•´ì™¸ì—¬í–‰ë³´í—˜ ë³´ì¥ ë²”ìœ„ í•œëˆˆì—","í•´ì™¸ ì¹˜ë£Œë¹„ ì²­êµ¬ ì ˆì°¨","í•­ê³µê¸° ì§€ì—°Â·ê²°í•­ ë³´ì¥",
      "ìˆ˜í•˜ë¬¼ ë¶„ì‹¤Â·íŒŒì† ë³´ì¥","ì—¬ê¶Œ ë¶„ì‹¤ ê¸´ê¸‰ì¡°ì¹˜","ì½”ë¡œë‚˜ ê´€ë ¨ ë³´ì¥ ì—¬ë¶€",
      "ì„ì‹  ì¤‘ ì—¬í–‰ ë³´ì¥ ìœ ì˜ì‚¬í•­","ë ˆì €Â·ìŠ¤í¬ì¸  íŠ¹ì•½ í•„ìš”ì„±","í•´ì™¸ ë³‘ì› ì˜ë¬¸ì„œë¥˜ ì¤€ë¹„",
      "í˜„ì§€ ë³‘ì› ì°¾ëŠ” ë²•Â·ì—°ë½ì²˜","ìê¸°ë¶€ë‹´ê¸ˆÂ·í•œë„ ì„¤ì •","ë™ë°˜ê°€ì¡± ë³´ì¥ ë²”ìœ„",
      "ì¥ê¸° ì—¬í–‰ìë³´í—˜ ì„ íƒ íŒ","ì›Œí™€Â·ìœ í•™ ë³´í—˜ ì²´í¬","í•´ì™¸ì—ì„œ ì•½êµ­ ì´ìš© íŒ",
      "ì˜ë¬¸ì§„ë‹¨ì„œ ë°œê¸‰ ë°©ë²•","ê·€êµ­ í›„ ì²­êµ¬ ì„œë¥˜ ì •ë¦¬","í˜„ì§€ í†µí™” ê²°ì œ/í™˜ë¶ˆ",
      "í•´ì™¸ ë ŒíŠ¸ì¹´ ì‚¬ê³  ì²˜ë¦¬","ì—¬í–‰ ì¤‘ ë„ë‚œ ì‹ ê³  ì ˆì°¨","ì§ˆë³‘ ì•…í™” ë©´ì±… ì¡°í•­",
      "ë§Œì„±ì§ˆí™˜ ë³µìš©ì•½ ì¤€ë¹„","íœ´ëŒ€í’ˆ í•œë„Â·ì˜ˆì™¸ ê·œì •","ì—¬í–‰ ì·¨ì†Œë¹„ìš© ë³´ì¥",
      "ê³ ì§€ì˜ë¬´ ìœ„ë°˜ ì£¼ì˜","í•´ì™¸ ì‚°í–‰Â·ìŠ¤ì¿ ë²„ ë³´ì¥","ëª¨ë°”ì¼ ì²­êµ¬ ë°©ë²•",
      "ì¥ê±°ë¦¬ ê²½ìœ  ì§€ì—° íŒ","ë¹„ì/ì…êµ­ ì œí•œ ì²´í¬","í•´ì™¸ ì˜ë£Œë¹„ ê²¬ì  ë¹„êµ"
    ],
    "ë‡ŒÂ·ì‹¬í˜ˆê´€": [
      "ë‡Œì¡¸ì¤‘ vs ë‡Œì¶œí˜ˆ ì°¨ì´","í—ˆí˜ˆì„±ì‹¬ì¥ì§ˆí™˜Â·ì‹¬ê·¼ê²½ìƒ‰ ì°¨ì´","í˜‘ì‹¬ì¦ ë³´ì¥ ê°€ëŠ¥ ë²”ìœ„",
      "ìŠ¤í…íŠ¸ ì‹œìˆ  ë³´ì¥ ì²´í¬","ì‹¬ì „ë„Â·Troponin ê¸°ì¤€ ì´í•´","MRI/MRA ê¸‰ì—¬Â·ë¹„ê¸‰ì—¬",
      "ì‘ê¸‰ì‹¤ ë‚´ì› ê¸°ë¡ ì¤‘ìš”ì„±","í›„ìœ ì¥í•´ ë³´ì¥ê³¼ í‰ê°€","ì¬í™œì¹˜ë£Œ ë¹„ìš©ê³¼ ì²­êµ¬",
      "ê³ í˜ˆì••Â·ê³ ì§€í˜ˆì¦ ê³ ì§€ì‚¬í•­","ì‹¬ì¥ì¬í™œ í”„ë¡œê·¸ë¨ ì•ˆë‚´","ë‡Œ MRI ì½”ë“œ ì •ë¦¬",
      "CT/MRI ì„ íƒ ê°€ì´ë“œ","ë‡Œí˜ˆê´€ ì§„ë‹¨ê¸ˆ ì§€ê¸‰ìš”ê±´","ì‹¬ê·¼ê²½ìƒ‰ ì§„ë‹¨ê¸ˆ ì˜ˆì‹œ",
      "ë‡Œì¡¸ì¤‘ í›„ìœ ì¦ ê´€ë¦¬ íŒ","ë‡Œí˜ˆê´€ ìˆ˜ìˆ ë¹„ ë³´ì¥","ì‹¬ì¥ ìŠ¤í…íŠ¸ ê°±ì‹  ì´ìŠˆ",
      "ë³‘ìƒì¼ë‹¹Â·ìˆ˜ìˆ ì¼ë‹¹ ì¡°í•©","ì¤‘í™˜ìì‹¤ ë³´ì¥ ì—¬ë¶€","êµ¬ê¸‰ì°¨ ì´ì†¡ë¹„ ì²­êµ¬",
      "ì•½ë¬¼ì¹˜ë£ŒÂ·ì¬ë°œ ë¦¬ìŠ¤í¬","í‡´ì› í›„ í†µì›ì¹˜ë£Œ ì²­êµ¬","ê±´ê°•ê²€ì§„ ì´ìƒì†Œê²¬ ëŒ€ì‘",
      "ìš´ì „ ê°€ëŠ¥ ì‹œì Â·ì„œë¥˜","ì¥ê¸°ë³µìš© ì•½ ê´€ë¦¬","ìƒí™œìŠµê´€ ê´€ë¦¬ ì²´í¬",
      "ì‚°ì¬/êµí†µì‚¬ê³ ì™€ ì¤‘ë³µ ì—¬ë¶€","ì§ˆë³‘ì½”ë“œ I21Â·I63 ì´í•´","ë³´í—˜ë£Œ ì ˆê° íŒ"
    ]
  }</script>

<script>
  // ========== ê³µí†µ ==========
  function isTestMode(){ return location.search.includes('test=true') || location.search.includes('debug=true'); }
  const HOOKS_BASE='https://hooks.xn--h32b21du9cf7grcy2k20f.com';
  const WF_PATH='ask';
  const WEBHOOK_URL = isTestMode()?`${HOOKS_BASE}/webhook-test/${WF_PATH}`:`${HOOKS_BASE}/webhook/${WF_PATH}`;
  if (isTestMode()){
    const indicator=document.createElement('div'); indicator.className='test-indicator'; indicator.textContent='TEST MODE';
    document.body.appendChild(indicator);
  }

  const $=(s)=>document.querySelector(s);
  const q=$('#q'), btn=$('#send'), res=$('#res'), sendLabel=$('#sendLabel');

  function loading(on){
    if(on){ btn.disabled=true; sendLabel.innerHTML='<span class="spin"></span>'; res.innerHTML='<div class="status"><span class="spin"></span>AI is workingâ€¦</div>'; }
    else { btn.disabled=false; sendLabel.textContent='Send'; }
  }

  async function postJson(url, body, timeoutMs=30000){
    const controller=new AbortController(); const t=setTimeout(()=>controller.abort(), timeoutMs);
    try{
      const r=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body),signal:controller.signal});
      const text=await r.text(); let data; try{data=JSON.parse(text);}catch{data={raw:text};}
      return {ok:r.ok,status:r.status,data};
    } finally { clearTimeout(t); }
  }

  function looksLikeHtml(s){ return /^\s*<(?:!DOCTYPE|html|body|main|div|section|article|h1|h2|p|iframe)\b/i.test(s||""); }
  function decodeHtmlEntities(str){ if(typeof str!=='string') return str; const el=document.createElement('textarea'); el.innerHTML=str; return el.value; }
  function extractEmbeddable(htmlString){
    try{
      const s=String(htmlString||"");
      const m=s.match(/^\s*<iframe\b[^>]*\bsrcdoc=(["'])([\s\S]*?)\1[^>]*>\s*<\/iframe>\s*$/i);
      if(m){ const ta=document.createElement('textarea'); ta.innerHTML=m[2]; return ta.value; }
      if(/^\s*<iframe\b/i.test(s)) return s;
      const parser=new DOMParser(); const doc=parser.parseFromString(s,'text/html');
      const main=doc.querySelector('main'); if(main) return main.innerHTML;
      if(doc.body) return doc.body.innerHTML || s;
      return s;
    }catch{ return htmlString; }
  }
  function pickHtmlPayload(data, fallback){
    const candidates=[data?.html_document,data?.html,data?.content,data?.body,data?.answer?.html_document,data?.answer?.html,data?.data?.html_document,data?.data?.html,data?.json?.html_document,data?.json?.html,fallback].filter(v=>typeof v==='string');
    for(let raw of candidates){ const dec=/&lt;|&gt;|&amp;|&quot;|&#39;/.test(raw)?decodeHtmlEntities(raw):raw; if(looksLikeHtml(dec)) return dec; }
    return null;
  }

  // ===== ìˆ˜ì • ëª¨ë“œ & ë‚´ë³´ë‚´ê¸° =====
  let editMode=false;
  const dlHtmlBtn=$('#downloadHtml'), dlPdfBtn=$('#downloadPdf'), toggleBtn=$('#toggleEdit'), toolbar=$('#toolbar');

  function enableExports(on){ if(dlHtmlBtn) dlHtmlBtn.disabled=!on; if(dlPdfBtn) dlPdfBtn.disabled=!on; }
  function currentResultHTML(){
    const inner=res.innerHTML||'';
    return '<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>result</title></head><body>'+inner+'</body></html>';
  }
  function downloadHTMLFile(){
    const blob=new Blob([currentResultHTML()],{type:'text/html;charset=utf-8'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='result.html'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }
  function downloadPDFFile(){
    const w=window.open('','_blank'); if(!w){ alert('íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.'); return; }
    w.document.open(); w.document.write(currentResultHTML()); w.document.close(); w.focus(); setTimeout(()=>w.print(),150);
  }
  function toggleEditMode(){
    editMode=!editMode;
    res.contentEditable=editMode?"true":"false";
    res.classList.toggle('editing',!!editMode);
    const onLabel=toggleBtn.getAttribute('data-on')||'ìˆ˜ì • ì¢…ë£Œ';
    const offLabel=toggleBtn.getAttribute('data-off')||'ìˆ˜ì • ëª¨ë“œ';
    toggleBtn.textContent=editMode?onLabel:offLabel;
    [...toolbar.querySelectorAll('.tool,.color-picker')].forEach(el=>el.disabled=!editMode);
  }
  if(dlHtmlBtn) dlHtmlBtn.addEventListener('click', downloadHTMLFile);
  if(dlPdfBtn) dlPdfBtn.addEventListener('click', downloadPDFFile);
  if(toggleBtn) toggleBtn.addEventListener('click', toggleEditMode);
  [...toolbar.querySelectorAll('.tool,.color-picker')].forEach(el=>el.disabled=true);

  // ===== ì „ì†¡ =====
  async function send(){
    const topic=q.value.trim(); if(topic.length<2){ q.focus(); res.textContent='Please enter at least 2 characters.'; return; }
    loading(true);
    try{
      const r=await postJson(WEBHOOK_URL,{topic});
      if(!r.ok){ res.textContent=`HTTP ${r.status}\n`+JSON.stringify(r.data,null,2); enableExports(false); return; }
      const ans=r.data?.answer ?? r.data?.data ?? r.data?.raw ?? r.data ?? {ok:true};
      const html=pickHtmlPayload(r.data, typeof ans==='string'?ans:'');
      if(html){
        const cleaned=decodeHtmlEntities(html); const emb=extractEmbeddable(cleaned);
        res.innerHTML=emb; res.style.whiteSpace='normal'; res.style.textAlign='left'; res.style.display='block'; res.style.minHeight='auto';
        res.contentEditable=editMode?"true":"false"; res.classList.toggle('editing',!!editMode);
        enableExports(true); attachResizeToImages(); scheduleIdleSave(); // ê²°ê³¼ ê°±ì‹  ì‹œ ì €ì¥ ì˜ˆì•½
        return;
      }
      res.textContent=(typeof ans==='string')?ans:JSON.stringify(ans,null,2);
      enableExports(true); scheduleIdleSave();
    }catch(e){
      res.textContent='Network error: '+(e?.message||String(e));
      enableExports(false);
    }finally{ loading(false); }
  }
  btn.addEventListener('click', send);
  q.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); send(); }});

  // ===== ì¹´í…Œê³ ë¦¬ íƒ­ + 3ê°œ ë¡œí…Œì´ì…˜ =====
  const tabsEl=$('#tabs'), helpersEl=$('#helpers'); const ROTATE_MS=12000;
  let categories={}, catNames=[], currentCat=null, order=[], cursor=0, rotateTimer=null;

  function loadCategories(){ try{ const raw=$('#topic-categories')?.textContent||'{}'; const obj=JSON.parse(raw); return obj&&typeof obj==='object'?obj:{}; }catch{ return {}; } }
  function shuffle(a){ const x=a.slice(); for(let i=x.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [x[i],x[j]]=[x[j],x[i]]; } return x; }
  function escHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  function escAttr(s){ return escHtml(s).replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

  function renderTabs(){
    tabsEl.innerHTML=catNames.map((c,i)=>`<button class="tab ${i===0?'active':''}" data-cat="${escAttr(c)}">${escHtml(c)}</button>`).join('');
    currentCat=catNames[0]||null; resetRotation();
  }
  function resetRotation(){
    const pool=(categories[currentCat]||[]); order=shuffle(pool.map((_,i)=>i)); cursor=0; renderHelpers();
    if(rotateTimer) clearInterval(rotateTimer); rotateTimer=setInterval(renderHelpers, ROTATE_MS);
  }
  function nextSet(n=3){
    const pool=(categories[currentCat]||[]); if(pool.length===0) return [];
    if(cursor>=order.length){ order=shuffle(order); cursor=0; }
    const idxs=order.slice(cursor, cursor+n); cursor+=n; return idxs.map(i=>pool[i]);
  }
  function renderHelpers(){ const items=nextSet(3); helpersEl.innerHTML=items.map(t=>`<button class="helper" data-text="${escAttr(t)}">${escHtml(t)}</button>`).join(''); }
  tabsEl.addEventListener('click',(e)=>{ const tab=e.target.closest('.tab'); if(!tab) return; tabsEl.querySelectorAll('.tab').forEach(x=>x.classList.remove('active')); tab.classList.add('active'); currentCat=tab.getAttribute('data-cat'); resetRotation(); });
  if(helpersEl){ helpersEl.addEventListener('click',(e)=>{ const b=e.target.closest('.helper'); if(!b) return; q.value=b.getAttribute('data-text')||b.textContent||''; }); }

  // ===== ì„œì‹ íˆ´ë°” =====
  function applyCmd(cmd,val=null){ if(!editMode) toggleEditMode(); document.execCommand(cmd,false,val); res.focus(); scheduleIdleSave(); }
  $('#toolbar').addEventListener('click',(e)=>{
    const b=e.target.closest('.tool'); if(!b) return;
    if(b.id==='mkLink'){ const url=prompt('ë§í¬ URLì„ ì…ë ¥í•˜ì„¸ìš”'); if(url && /^https?:\/\//i.test(url)) applyCmd('createLink',url); return; }
    const cmd=b.getAttribute('data-cmd'); const val=b.getAttribute('data-val'); if(cmd) applyCmd(cmd,val);
  });
  $('#foreColor').addEventListener('input',(e)=>{ applyCmd('foreColor', e.target.value); });

  // ===== ì „ì²´ ê¸€ì”¨ í¬ê¸°(A-/A+) & ì„ íƒ ê¸€ìí¬ê¸° ìŠ¬ë¼ì´ë” =====
  let globalFont=100;
  function applyGlobalFont(){ res.style.fontSize=globalFont+'%'; $('#fontVal').textContent=globalFont+'%'; scheduleIdleSave(); }
  $('#fontDown').addEventListener('click',()=>{ globalFont=Math.max(70, globalFont-10); applyGlobalFont(); });
  $('#fontUp').addEventListener('click',()=>{ globalFont=Math.min(200, globalFont+10); applyGlobalFont(); });

  $('#selFont').addEventListener('input',(e)=>{
    const size=parseInt(e.target.value,10);
    if(!editMode) toggleEditMode();
    const sel=window.getSelection();
    if(!sel || sel.rangeCount===0) return;
    const range=sel.getRangeAt(0);
    const span=document.createElement('span'); span.style.fontSize=size+'%';
    range.surroundContents(span);
    sel.removeAllRanges(); const r=document.createRange(); r.selectNodeContents(span); sel.addRange(r);
    scheduleIdleSave();
  });

  // ===== ì´ë¯¸ì§€ ë“œë˜ê·¸&ë“œë¡­/ë¶™ì—¬ë„£ê¸° + ë¦¬ì‚¬ì´ì¦ˆ =====
  function insertAtCaret(node){
    const sel=window.getSelection();
    if(sel && sel.rangeCount && res.contains(sel.anchorNode)){
      const range=sel.getRangeAt(0); range.deleteContents(); range.insertNode(node); range.collapse(false); sel.removeAllRanges(); sel.addRange(range);
    } else { res.appendChild(node); }
  }
  function handleFiles(files){
    if(!files || !files.length) return;
    if(!editMode) toggleEditMode();
    [...files].forEach(file=>{
      if(!file.type.startsWith('image/')) return;
      const reader=new FileReader();
      reader.onload=()=>{
        const img=new Image(); img.src=reader.result; img.style.maxWidth='100%'; img.style.height='auto'; img.style.display='block'; img.style.margin='8px 0';
        insertAtCaret(img); attachResizeToImage(img); scheduleIdleSave();
      };
      reader.readAsDataURL(file);
    });
  }
  res.addEventListener('dragover', (e)=>{ e.preventDefault(); res.classList.add('editing'); });
  res.addEventListener('dragleave', ()=>{ res.classList.toggle('editing', !!editMode); });
  res.addEventListener('drop', (e)=>{ e.preventDefault(); handleFiles(e.dataTransfer.files); res.classList.toggle('editing', !!editMode); });
  res.addEventListener('paste', (e)=>{
    const items=e.clipboardData && e.clipboardData.items; if(!items) return;
    const imgs=[]; for(const it of items){ if(it.type && it.type.indexOf('image/')===0) imgs.push(it.getAsFile()); }
    if(imgs.length){ e.preventDefault(); handleFiles(imgs); }
  });

  // ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ: í´ë¦­ ì‹œ í•¸ë“¤ + íŒ¨ë„
  let currentImg=null, handleEl=null, fabEl=null, startX=0, startW=0;
  function attachResizeToImages(){ res.querySelectorAll('img').forEach(attachResizeToImage); }
  function attachResizeToImage(img){
    img.style.cursor='pointer';
    img.addEventListener('click', (e)=>{ e.stopPropagation(); selectImage(img); });
  }
  function selectImage(img){
    if(currentImg===img){ showFab(img); return; }
    clearImageUI();
    currentImg=img; img.classList.add('img-selected'); showHandle(img); showFab(img);
  }
  function clearImageUI(){
    if(currentImg) currentImg.classList.remove('img-selected');
    if(handleEl){ handleEl.remove(); handleEl=null; }
    if(fabEl){ fabEl.remove(); fabEl=null; }
    currentImg=null;
  }
  document.addEventListener('click',(e)=>{ if(!res.contains(e.target)) clearImageUI(); });

  function showHandle(img){
    const rect=img.getBoundingClientRect();
    handleEl=document.createElement('div'); handleEl.className='img-handle';
    // í•¸ë“¤ì€ ì´ë¯¸ì§€ì˜ offsetParent ê¸°ì¤€ ìœ„ì¹˜ê°€ í•„ìš” â†’ wrapper ì—†ì´ position:relative ëŒ€ì²´
    img.style.position='relative';
    img.parentElement.style.position='relative';
    img.parentElement.appendChild(handleEl);

    handleEl.addEventListener('mousedown',(e)=>{
      e.preventDefault();
      startX=e.clientX; startW=img.getBoundingClientRect().width;
      const onMove=(me)=>{
        const dx=me.clientX-startX;
        const newW=Math.max(50, startW+dx);
        const parentW=img.parentElement.getBoundingClientRect().width||newW;
        const pct=Math.round((newW/parentW)*100);
        img.style.width=pct+'%'; img.style.maxWidth='100%';
        updateFab(pct);
      };
      const onUp=()=>{ document.removeEventListener('mousemove',onMove); document.removeEventListener('mouseup',onUp); scheduleIdleSave(); };
      document.addEventListener('mousemove',onMove); document.addEventListener('mouseup',onUp);
    });
  }
  function showFab(img){
    if(fabEl) fabEl.remove();
    fabEl=document.createElement('div'); fabEl.className='img-fab';
    const parentW=img.parentElement.getBoundingClientRect().width||img.width;
    const curPct=Math.round((img.getBoundingClientRect().width/parentW)*100)||100;
    fabEl.innerHTML=`
      <input type="range" min="10" max="100" value="${Math.max(10, Math.min(100, curPct))}">
      <button class="p50">50%</button>
      <button class="p75">75%</button>
      <button class="p100">100%</button>
    `;
    // ìœ„ì¹˜: ì´ë¯¸ì§€ ìƒë‹¨ ì¤‘ì•™
    img.parentElement.style.position='relative';
    img.parentElement.appendChild(fabEl);

    const range=fabEl.querySelector('input[type="range"]');
    range.addEventListener('input',(e)=>{ const v=parseInt(e.target.value,10); img.style.width=v+'%'; updateFab(v); });
    fabEl.querySelector('.p50').addEventListener('click',()=>{ img.style.width='50%'; updateFab(50); scheduleIdleSave(); });
    fabEl.querySelector('.p75').addEventListener('click',()=>{ img.style.width='75%'; updateFab(75); scheduleIdleSave(); });
    fabEl.querySelector('.p100').addEventListener('click',()=>{ img.style.width='100%'; updateFab(100); scheduleIdleSave(); });
  }
  function updateFab(pct){
    if(!fabEl) return;
    const range=fabEl.querySelector('input[type="range"]');
    if(range) range.value=Math.max(10,Math.min(100, pct));
  }

  // ===== ì¹´ì¹´ì˜¤ ë§í¬ ìƒì„±ê¸° (ì›ë³¸ ìœ ì§€) =====
  (function(){
    const BASE='https://hooks.xn--h32b21du9cf7grcy2k20f.com/webhook/kakao-redirect';
    const key=$('#k-key'); const btnMake=$('#k-make'); const btnCopy=$('#k-copy'); const out=$('#k-result');
    function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,10); }
    function build(){ const kw=(key.value||'').trim(); if(!kw){ out.textContent='í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”'; out.classList.add('placeholder'); return; } const u=uid(); const qs=new URLSearchParams({ref:kw,utm_content:u}).toString(); const url=BASE+(BASE.includes('?')?'&':'?')+qs; out.innerHTML=`<a href="${url}" target="_blank" rel="noopener">${url}</a>`; out.classList.remove('placeholder'); }
    async function copy(){ const a=out.querySelector('a'); const url=a?a.href:(out.textContent||'').trim(); if(!/^https?:\/\//.test(url)){ out.textContent='ë¨¼ì € ë§í¬ë¥¼ ìƒì„±í•˜ì„¸ìš”'; out.classList.add('placeholder'); return; } try{ await navigator.clipboard.writeText(url); btnCopy.textContent='ë³µì‚¬ ì™„ë£Œ âœ…'; setTimeout(()=>btnCopy.textContent='ë³µì‚¬ ğŸ“‹',1200);}catch{ const t=document.createElement('textarea'); t.value=url; document.body.appendChild(t); t.select(); document.execCommand('copy'); t.remove(); btnCopy.textContent='ë³µì‚¬ ì™„ë£Œ âœ…'; setTimeout(()=>btnCopy.textContent='ë³µì‚¬ ğŸ“‹',1200);} }
    if(btnMake) btnMake.addEventListener('click', build);
    if(btnCopy) btnCopy.addEventListener('click', copy);
    if(key) key.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ e.preventDefault(); build(); }});
  })();

  // ===== ìë™ ì €ì¥ (ìœ íœ´ 1ë¶„ + ì£¼ê¸° 5ë¶„) & ë³µì› =====
  const DRAFT_KEY='blog_auto_draft_v1';
  let idleTimer=null, periodicTimer=null;

  function serializeDraft(){ return { v:3, ts:Date.now(), topic:(q?.value||'').trim(), html:res?.innerHTML||'', edit:!!editMode, globalFont }; }
  function saveDraft(){ try{ const data=serializeDraft(); localStorage.setItem(DRAFT_KEY, JSON.stringify(data)); /*console.log('saved', new Date(data.ts))*/ }catch(e){ console.warn('autosave failed',e); } }
  function scheduleIdleSave(){ if(idleTimer) clearTimeout(idleTimer); idleTimer=setTimeout(saveDraft, 60*1000); } // 1ë¶„ ìœ íœ´
  function startPeriodicSave(){ if(periodicTimer) clearInterval(periodicTimer); periodicTimer=setInterval(saveDraft, 5*60*1000); } // 5ë¶„ ì£¼ê¸°
  function restoreDraft(){
    try{
      const raw=localStorage.getItem(DRAFT_KEY); if(!raw) return;
      const data=JSON.parse(raw); if(!data||typeof data!=='object') return;
      if(typeof data.topic==='string') q.value=data.topic;
      if(typeof data.html==='string'){ res.innerHTML=data.html; enableExports(true); attachResizeToImages(); }
      if(data.edit){ if(!editMode) toggleEditMode(); }
      if(data.globalFont){ globalFont=data.globalFont; res.style.fontSize=globalFont+'%'; $('#fontVal').textContent=globalFont+'%'; }
    }catch(e){ console.warn('restore failed', e); }
  }
  function bindAutoSaveEvents(){
    if(q) q.addEventListener('input', scheduleIdleSave);
    if(res) res.addEventListener('input', scheduleIdleSave);
    document.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='hidden') saveDraft(); });
    window.addEventListener('beforeunload', saveDraft);
    startPeriodicSave();
  }

  // ===== ìŠ¤ëƒ…ìƒ·(íˆìŠ¤í† ë¦¬) =====
  const SNAP_KEY='blog_snapshots_v1'; const snapSelect=$('#snapSelect');
  function loadSnaps(){ try{ const raw=localStorage.getItem(SNAP_KEY); const arr=raw?JSON.parse(raw):[]; return Array.isArray(arr)?arr:[]; }catch{return [];} }
  function saveSnaps(arr){ localStorage.setItem(SNAP_KEY, JSON.stringify(arr)); }
  function refreshSnapSelect(){
    const arr=loadSnaps();
    snapSelect.innerHTML=arr.map((s,i)=>`<option value="${i}">${new Date(s.ts).toLocaleString()} â€” ${s.topic?.slice(0,24)||'ì œëª©ì—†ìŒ'}</option>`).join('');
  }
  function snapNow(){
    const arr=loadSnaps();
    const data=serializeDraft();
    arr.unshift(data);
    if(arr.length>10) arr.length=10; // ìµœëŒ€ 10ê°œ ìœ ì§€
    saveSnaps(arr); refreshSnapSelect();
  }
  function loadSnap(){
    const arr=loadSnaps(); const idx=parseInt(snapSelect.value||'0',10);
    const s=arr[idx]; if(!s) return;
    q.value=s.topic||''; res.innerHTML=s.html||''; enableExports(true); attachResizeToImages();
    if(!!s.edit && !editMode) toggleEditMode(); if(!s.edit && editMode) toggleEditMode();
    globalFont=s.globalFont||100; res.style.fontSize=globalFont+'%'; $('#fontVal').textContent=globalFont+'%';
    scheduleIdleSave();
  }
  function delSnap(){
    const arr=loadSnaps(); const idx=parseInt(snapSelect.value||'0',10);
    if(arr[idx]){ arr.splice(idx,1); saveSnaps(arr); refreshSnapSelect(); }
  }
  $('#btnSnapSave').addEventListener('click', snapNow);
  $('#btnSnapLoad').addEventListener('click', loadSnap);
  $('#btnSnapDel').addEventListener('click', delSnap);

  // ===== ë¶€íŒ… =====
  function init(){
    // ì¹´í…Œê³ ë¦¬
    categories=loadCategories(); catNames=Object.keys(categories);
    if(catNames.length){ renderTabs(); } else { $('#tabs').innerHTML=''; $('#helpers').innerHTML='<div class="placeholder">ì£¼ì œ í’€ì´ ì—†ìŠµë‹ˆë‹¤</div>'; }
    // ë³µì› & ì˜¤í† ì„¸ì´ë¸Œ
    restoreDraft(); bindAutoSaveEvents(); refreshSnapSelect();
    // ì´ˆê¸° ì´ë¯¸ì§€ì— ë¦¬ì‚¬ì´ì¦ˆ ë¶€ì°©(ìˆë‹¤ë©´)
    attachResizeToImages();
  }
  document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
